<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    

    <title>Linux操作系统上安装Zabbix运维工具并基础配置 | 四十荀的博客</title>
    <meta property="og:title" content="Linux操作系统上安装Zabbix运维工具并基础配置 - 四十荀的博客">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2022-08-10T15:49:35&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2022-08-10T15:49:35&#43;08:00'>
        
    <meta name="Keywords" content="[linux, zabbix, 运维监控]">
    <meta name="description" content="Linux操作系统上安装Zabbix运维工具并基础配置">
        
    <meta name="author" content="四十荀">
    <meta property="og:url" content="https://xy-ylr.github.io/it/linux_install_zabbix/">
    <link rel="shortcut icon" href='/favicon.ico'  type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
        <link href="https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" rel="stylesheet">
    
    
    
    
</head>

<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://xy-ylr.github.io">
                        四十荀的博客
                    </a>
                
                <p class="description">运维工程师, 未来新农人, 间歇性运动</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="" href="https://xy-ylr.github.io">首页</a>
                    
                    <a  href="https://xy-ylr.github.io/it/" title="计算机">计算机</a>
                    
                    <a  href="https://xy-ylr.github.io/licai/" title="理财">理财</a>
                    
                    <a  href="https://xy-ylr.github.io/nongye/" title="农业">农业</a>
                    
                    <a  href="https://xy-ylr.github.io/yundong/" title="健身">健身</a>
                    
                    <a  href="https://xy-ylr.github.io/archives/" title="归档">归档</a>
                    
                    <a  href="https://xy-ylr.github.io/about/" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    <style type="text/css">
    .post-toc {
        position: fixed;
        width: 200px;
        margin-left: -230px;
        padding: 5px 10px;
        font-family: Athelas, STHeiti, Microsoft Yahei, serif;
        font-size: 12px;
        border: 1px solid rgba(0, 0, 0, .07);
        border-radius: 5px;
        background-color: rgba(255, 255, 255, 0.98);
        background-clip: padding-box;
        -webkit-box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        word-wrap: break-word;
         
         
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        z-index: 999;
        cursor: pointer;
        max-height: 70%;
        overflow-y: auto;
        overflow-x: hidden;
    }

    .post-toc .post-toc-title {
        width: 100%;
        margin: 0 auto;
        font-size: 20px;
        font-weight: 400;
        text-transform: uppercase;
        text-align: center;
    }

    .post-toc .post-toc-content {
        font-size: 15px;
    }

    .post-toc .post-toc-content>nav>ul {
        margin: 10px 0;
    }

    .post-toc .post-toc-content ul {
        padding-left: 20px;
        list-style: square;
        margin: 0.5em;
        line-height: 1.8em;
    }

    .post-toc .post-toc-content ul ul {
        padding-left: 15px;
         
         
    }

    @media print,
    screen and (max-width:1057px) {
        .post-toc {
            display: none;
        }
    }
</style>
<div class="post-toc" style="position: absolute; top: 188px;">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#安装包安装">安装包安装</a>
      <ul>
        <li><a href="#系统环境">系统环境</a></li>
        <li><a href="#安装zabbix库">安装zabbix库</a></li>
        <li><a href="#安装zabbix">安装zabbix</a></li>
        <li><a href="#安装mysql数据库">安装mysql数据库</a></li>
        <li><a href="#初始化数据库">初始化数据库</a></li>
        <li><a href="#创建zabbix数据库">创建zabbix数据库</a></li>
        <li><a href="#启动zabbix">启动zabbix</a></li>
        <li><a href="#初始化web端">初始化web端</a></li>
      </ul>
    </li>
    <li><a href="#zabbix-appliance快速安装">Zabbix Appliance快速安装</a>
      <ul>
        <li><a href="#下载并安装">下载并安装</a></li>
        <li><a href="#配置网络">配置网络</a></li>
        <li><a href="#补充安装">补充安装</a></li>
        <li><a href="#默认密码">默认密码</a></li>
        <li><a href="#磁盘管理">磁盘管理</a></li>
      </ul>
    </li>
    <li><a href="#添加主机监控">添加主机监控</a></li>
    <li><a href="#配置模板">配置模板</a></li>
    <li><a href="#自动发现主机">自动发现主机</a>
      <ul>
        <li><a href="#关联动作">关联动作</a></li>
      </ul>
    </li>
    <li><a href="#补充配置">补充配置</a>
      <ul>
        <li><a href="#自动发现进程和缓存">自动发现进程和缓存</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function () {
        var postToc = $(".post-toc");
        if (postToc.length) {
            var leftPos = $("#main").offset().left;
            if (leftPos < 220) {
                postToc.css({ "width": leftPos - 10, "margin-left": (0 - leftPos) })
            }

            var t = postToc.offset().top - 20,
                a = {
                    start: {
                        position: "absolute",
                        top: t
                    },
                    process: {
                        position: "fixed",
                        top: 20
                    },
                };
            $(window).scroll(function () {
                var e = $(window).scrollTop();
                e < t ? postToc.css(a.start) : postToc.css(a.process)
            })
        }

        if ($("#TableOfContents").children().length < 1) {
            $(".post-toc").remove();
        }
    })
</script>
    <article class="post">
        <header>
            <h1 class="post-title">Linux操作系统上安装Zabbix运维工具并基础配置</h1>
        </header>
        <date class="post-meta meta-date">
            2022年8月10日
        </date>
        
        <div class="post-meta">
            <span>|</span>
            
            <span class="meta-category"><a href='/categories/linux'>linux</a></span>
            
            <span class="meta-category"><a href='/categories/zabbix'>zabbix</a></span>
            
            <span class="meta-category"><a href='/categories/%E8%BF%90%E7%BB%B4'>运维</a></span>
            
        </div>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-meta">
            <span>|</span>
            <span> 共约7236字 </span>
            <span> 预计阅读时间15分钟</span>
        </div>
        
        
        <div class="clear" style="display: none">
            <div class="toc-article">
                <div class="toc-title">文章目录</div>
            </div>
        </div>
        
        
        

    
    
    

    
    


<div class="post-outdated">
    
    <div class="warn">
    
        <p>【注意】本文最后更新于 
            <span class="timeago" datetime="2022-08-10T15:49:35" title="2022-08-10">
            2022-08-10
            </span>，文中内容可能已过时，请谨慎使用。
        </p>
    </div>
</div>



        <div class="post-content">
            <p>记录一下个人模拟安装zabbix的过程。</p>
<p><strong>前置说明</strong>：实际生产环境部署，可能是处于内网环境，如果客户允许，可以先在联网条件下安装zabbix，接着完善各种补充功能，然后再将迁移到内网。下文优先参考<a href="#zabbix-appliance%E5%BF%AB%E9%80%9F%E5%AE%89%E8%A3%85">appliance安装</a>，本人通过该安装方式，一步步最终部署到了生产环境。</p>
<h2 id="安装包安装">安装包安装</h2>
<h3 id="系统环境">系统环境</h3>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@iZuf61w67sbi47k6nrw8jlZ ~<span style="color:#f92672">]</span><span style="color:#75715e"># lsb_release -a</span>
LSB Version:	:core-4.1-amd64:core-4.1-noarch
Distributor ID:	AlibabaCloud
Description:	Alibaba Cloud Linux release <span style="color:#ae81ff">3</span> <span style="color:#f92672">(</span>Soaring Falcon<span style="color:#f92672">)</span> 
Release:	<span style="color:#ae81ff">3</span>
Codename:	SoaringFalcon
</code></pre></td></tr></table>
</div>
</div><h3 id="安装zabbix库">安装zabbix库</h3>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">rpm -Uvh https://repo.zabbix.com/zabbix/5.4/rhel/8/x86_64/zabbix-release-5.4-1.el8.noarch.rpm
</code></pre></td></tr></table>
</div>
</div><p><strong>注意</strong>： 可能阿里云系统做了一些优化，本地rocky linux 9.1环境，安装zabbix6.0（其他版本同）参考<a href="https://www.zabbix.com/cn/download?zabbix=6.0&amp;os_distribution=rocky_linux&amp;os_version=9&amp;components=server_frontend_agent&amp;db=mysql&amp;ws=nginx">官方教程</a>，如果操作系统已经有配置epel源，需要先禁用其中的zabbix软件包。</p>
<p>编辑配置文件<code>/etc/yum.repos.d/epel.repo</code>并添加以下语句</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>epel<span style="color:#f92672">]</span>
...
<span style="color:#111">excludepkgs</span><span style="color:#f92672">=</span>zabbix*
</code></pre></td></tr></table>
</div>
</div><h3 id="安装zabbix">安装zabbix</h3>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">yum install zabbix-server-mysql zabbix-web-mysql zabbix-apache-conf zabbix-sql-scripts zabbix-agent -y 
</code></pre></td></tr></table>
</div>
</div><p>此命令会安装zabbix server服务端, web前端, zabbix agent客户端. 当看到<strong><code>Complete!</code></strong>的输出显示时, 说明全部安装成功了.</p>
<h3 id="安装mysql数据库">安装mysql数据库</h3>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">yum install -y mariadb-server 
systemctl start mariadb 
systemctl <span style="color:#111">enable</span> mariadb
systemctl status mariadb
</code></pre></td></tr></table>
</div>
</div><p>主要是第一条命令用于安装数据库, 后续是用于启动数据库的, 安装完成应该会自动启动, 最后一条用于查看数据库启动状态, 如果能看到<code>enabled</code>, <code>active (running)</code>等字样, 说明已经安装成功并且正常启动了. 也可以使用<code>ps -ef | grep mysql</code>来确认, 会有两行以上输出, 一行是该命令本身, 一行是数据库进程相关信息.</p>
<p><strong>注意</strong>: 可以发现, 我们安装的是mariadb, 结果却是mysql, 简单理解, mariadb是mysql的一个分支, 完全兼容mysql数据库.</p>
<h3 id="初始化数据库">初始化数据库</h3>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mysql_secure_installation
</code></pre></td></tr></table>
</div>
</div><p>过程中需要几步互动操作, 包括设置数据库root用户密码, 关闭root用户远程登录权限, 移除匿名用户, 移除test测试用户, 重新加载权限表以使配置立即生效.</p>
<p>操作完成最后能看到提示<code>Thanks for using MariaDB!</code>, 表示数据库环境已经基本配置完成. 接下来可以正式为zabbix创建数据库了</p>
<h3 id="创建zabbix数据库">创建zabbix数据库</h3>
<p>先在命令行输入命令<code>mysql -uroot -p</code>, 然后输入root用户的密码, 登录数据库.</p>
<p>然后在数据库中输入如下代码创建一个zabbix数据库, 以及一个zabbix数据库用户, 密码为password.</p>
<p><strong>注意</strong>： 以下语句针对5.4版本，其他版本可能会有一些差别，详情见<a href="https://www.zabbix.com/download">官方教程</a>。</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql"><span style="color:#00a8c8">create</span> <span style="color:#00a8c8">database</span> <span style="color:#111">zabbix</span> <span style="color:#00a8c8">character</span> <span style="color:#00a8c8">set</span> <span style="color:#111">utf8</span> <span style="color:#00a8c8">collate</span> <span style="color:#111">utf8_bin</span><span style="color:#111">;</span> 

<span style="color:#00a8c8">create</span> <span style="color:#00a8c8">user</span> <span style="color:#111">zabbix</span><span style="color:#f92672">@</span><span style="color:#111">localhost</span> <span style="color:#00a8c8">identified</span> <span style="color:#00a8c8">by</span> <span style="color:#d88200">&#39;password&#39;</span><span style="color:#111">;</span> 

<span style="color:#00a8c8">grant</span> <span style="color:#00a8c8">all</span> <span style="color:#00a8c8">privileges</span> <span style="color:#00a8c8">on</span> <span style="color:#111">zabbix</span><span style="color:#111">.</span><span style="color:#f92672">*</span> <span style="color:#00a8c8">to</span> <span style="color:#111">zabbix</span><span style="color:#f92672">@</span><span style="color:#111">localhost</span><span style="color:#111">;</span> 

<span style="color:#111">quit</span><span style="color:#111">;</span>
</code></pre></td></tr></table>
</div>
</div><p>到这一步还只是创建了一个空数据库, 接下来导入zabbix默认的表结构等数据以完成数据库创建.</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">zcat /usr/share/doc/zabbix-sql-scripts/mysql/create.sql.gz <span style="color:#111">|</span> mysql -uzabbix -p zabbix
</code></pre></td></tr></table>
</div>
</div><h3 id="启动zabbix">启动zabbix</h3>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">systemctl restart zabbix-server zabbix-agent httpd php-fpm 

systemctl <span style="color:#111">enable</span> zabbix-server zabbix-agent httpd php-fpm
</code></pre></td></tr></table>
</div>
</div><p>以上两条命令用于启动并设置zabbix程序开机自启动. 还是一样, 可以通过<code>systemctl status</code>来查看相关程序是否已经正常启动.</p>
<h3 id="初始化web端">初始化web端</h3>
<p>通过浏览器访问<code>http://[服务器IP]/zabbix</code>, 如果前面配置都正常完成, 此时在浏览器上能看到zabbix欢迎页面, 提示我们继续进行安装配置. 默认登录zabbix的用户名是 <strong>Admin</strong>, 密码是 <strong>zabbix</strong></p>
<p><strong>补充</strong>：本地rocky环境下用的nginx服务，初始化完成后要登录zabbix web控制台，访问的网址是<code>http://[服务器ip]:8080</code>，忘记之前在阿里云上测试，使用apache的时候，是不是要加8080端口了，这里先记录一下。</p>
<h4 id="安装中文语言包">安装中文语言包</h4>
<p><strong>以下操作系统环境为：本地虚拟机rocky9.1</strong></p>
<p>默认安装情况下可选语言可能只有英文，其他比如中文等语言为灰色无法选择。</p>
<p>这个跟操作系统本身的语言环境有关系，<a href="https://www.zabbix.com/documentation/6.0/zh/manual/appendix/install/locales">官方教程-其他前端语言</a>提到的<code>locale-gen</code>等，本地虚拟机环境没有相应命令，结合网上其他人关于zabbix安装中文语言包的教程。</p>
<p>首先查看系统已安装语言环境：</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>xy@localhost ~<span style="color:#f92672">]</span>$ locale -a
C
C.utf8
POSIX
</code></pre></td></tr></table>
</div>
</div><p>可以看到没有<code>zh_CN</code>相关的中文提示，搜索并安装相应语言包：</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>xy@localhost ~<span style="color:#f92672">]</span>$ dnf search zh_CN
Last metadata expiration check: 12:07:03 ago on Sat Jan <span style="color:#ae81ff">28</span> 10:24:16 2023.
<span style="color:#f92672">=====================================</span> Name Matched: <span style="color:#111">zh_CN</span> <span style="color:#f92672">======================================</span>
langpacks-core-font-zh_CN.noarch : Simplified Chinese core font meta-package
langpacks-core-zh_CN.noarch : Simplified Chinese langpacks core meta-package
langpacks-zh_CN.noarch : Simplified Chinese langpacks meta-package
<span style="color:#f92672">[</span>xy@localhost ~<span style="color:#f92672">]</span>$ sudo dnf install -y langpacks-zh_CN
</code></pre></td></tr></table>
</div>
</div><p>然后重新加载系统语言环境，即<code>glibc-common</code>软件包，系统上应该已经安装过了，可以先尝试使用<code>sudo dnf reinstall glibc-common</code>，如果不行，再用<code>install</code>。之后再次查看语言环境，可以发现已经有了中文。</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>xy@localhost ~<span style="color:#f92672">]</span>$ sudo dnf install glibc-common
……
<span style="color:#f92672">[</span>xy@localhost ~<span style="color:#f92672">]</span>$ locale -a
C
C.utf8
POSIX
zh_CN
zh_CN.gb18030
zh_CN.gbk
zh_CN.utf8
……
</code></pre></td></tr></table>
</div>
</div><p>再回到zabbix web前端操作。</p>
<p>如果是刚开始初始化web前端，此时直接刷新页面应该就可以选择中文了，或者先重启以下zabbix（这一步应该可以省略）</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>xy@localhost ~<span style="color:#f92672">]</span>$ sudo systemctl restart zabbix-server.service 
</code></pre></td></tr></table>
</div>
</div><p>如果是在英文界面已经配置好了，那登录前端界面之后，可以在<code>Administration</code>-&gt;<code>General</code>-&gt;<code>GUI</code>处更改默认语言。</p>
<h2 id="zabbix-appliance快速安装">Zabbix Appliance快速安装</h2>
<p>通过安装包安装的时候，相关软件都需要一步步手动安装，并配置数据库。而zabbix appliance是官方提供的基于almalinux系统的已完成zabbix基本配置的系统镜像，对于测试环境或者轻度用户来说比较友好，基本算是一步到位。参考<a href="https://www.zabbix.com/documentation/6.0/zh/manual/appliance">官网zabbix appliance安装</a>。</p>
<h3 id="下载并安装">下载并安装</h3>
<p>这里以vmware workstation虚拟化安装zabbix appliance为例，<a href="https://www.zabbix.com/download_appliance">官方下载适用于vmware的压缩包</a>，解压缩得到<code>zabbix_appliance-版本号-vmx</code>文件夹，然后将之重命名并剪切到vmware虚拟机目录下面，比如<code>C:\VMwareWorkstation\Virtual Machines\</code>。</p>
<p>vmware新建虚拟机，先配置cpu、内存等，在配置磁盘的时候，选择使用<strong>现有虚拟磁盘</strong>，如果后面要用于生产环境的话，记得先<strong>调整磁盘空间大小</strong>（比如500G，参考本文<a href="#%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86">磁盘管理</a>的说明），默认只有10G，最后开启虚拟机，喝口茶的功夫就完成了。</p>
<p>此时虚拟机系统——下文称该系统为zabbix系统，<strong>默认帐号密码</strong>是：root/zabbix。</p>
<h3 id="配置网络">配置网络</h3>
<p>刚安装完成，虚拟机网络配置是DHCP，需要修改为静态IP。IP地址配置文件大概率是<code>/etc/sysconfig/network-scripts/ifcfg-eth0</code>，可以使用<code>ip addr s</code>来确认，返回结果中有网络名称，编辑文件内容如下，IP地址、网关、掩码等根据实际情况修改。</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#111">DEVICE</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;eth0&#34;</span>
<span style="color:#111">BOOTPROTO</span><span style="color:#f92672">=</span>none
<span style="color:#111">NM_CONTROLLED</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;no&#34;</span>
<span style="color:#111">PERSISTENT_DHCLIENT</span><span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
<span style="color:#111">ONBOOT</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;yes&#34;</span>
<span style="color:#111">TYPE</span><span style="color:#f92672">=</span>Ethernet
<span style="color:#111">DEFROUTE</span><span style="color:#f92672">=</span>yes
<span style="color:#111">PEERDNS</span><span style="color:#f92672">=</span>yes
<span style="color:#111">PEERROUTES</span><span style="color:#f92672">=</span>yes
<span style="color:#111">IPV4_FAILURE_FATAL</span><span style="color:#f92672">=</span>yes
<span style="color:#111">NAME</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;eth0&#34;</span>
<span style="color:#111">IPADDR</span><span style="color:#f92672">=</span>192.168.120.18
<span style="color:#111">PREFIX</span><span style="color:#f92672">=</span><span style="color:#ae81ff">24</span>
<span style="color:#111">GATEWAY</span><span style="color:#f92672">=</span>192.168.120.254
<span style="color:#111">DNS1</span><span style="color:#f92672">=</span>192.168.120.254
</code></pre></td></tr></table>
</div>
</div><p>完成之后执行<code>systemctl restart network</code>重启网络，然后再次执行<code>ip addr s</code>就能看到IP地址变成了我们设定的值。</p>
<h3 id="补充安装">补充安装</h3>
<p>在开始安装前，推荐将系统yum源修改为国内镜像源，能够加快下载速度。参考：<a href="https://mirrors.zju.edu.cn/docs/almalinux/">浙江大学开源软件镜像站-AlmaLinux</a>。</p>
<h4 id="安装命令补全和中文语言包">安装命令补全和中文语言包</h4>
<p>zabbix系统无法通过<kbd>Tab</kbd>键补全命令，也没有中文语言包，补充一下</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@appliance ~<span style="color:#f92672">]</span><span style="color:#75715e"># dnf install -y bash-completion</span>
<span style="color:#f92672">[</span>root@appliance ~<span style="color:#f92672">]</span><span style="color:#75715e"># dnf install -y langpacks-zh_CN</span>
<span style="color:#f92672">[</span>root@appliance ~<span style="color:#f92672">]</span><span style="color:#75715e"># dnf install -y glibc-common</span>
</code></pre></td></tr></table>
</div>
</div><p>浏览器访问zabbix系统，<strong>默认帐号密码</strong>：Admin/zabbix，登录之后在<code>User settings / Profile</code>中修改语言为中文。</p>
<p>顺便还可以选择一下时区，比如<code>(UTC+08:00) Asia/Shanghai</code>。</p>
<p>或者是直接修改系统默认时区为东8区：</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@appliance ~<span style="color:#f92672">]</span><span style="color:#75715e"># cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span>
</code></pre></td></tr></table>
</div>
</div><p>到这一步就跟前文的软件包安装一样，完成了基本安装配置，轻松了不少，而且根据官方说明，还使用iptables防火墙预配置一些基本规则，比如放行ssh端口、snmp trap端口等，更是进一步减轻工作量。后面只需再确认一下，将zabbix、mysql等配置为开机启动就可以了。</p>
<h4 id="snmp-trap相关">SNMP Trap相关</h4>
<p>zabbix可以通过snmp主动获取被监控主机的相关信息，但是对于被监控主机突发的故障等，可能无法及时获知。如果频繁的主动发起snmpget获取主机信息，对于zabbix服务器、整体网络资源等，都会产生额外的资源消耗。而配置snmp trap就可以降低主动监控的频率，又可以在被监控主机出现问题的时候，自动接收被监控主机发送过来的trap消息，具体内容看<a href="/it/zabbix_snmp_trap/">zabbix配置snmp trap接收主机告警</a>。</p>
<p><strong>补充</strong>：本地虚拟机安装zabbix，开机运行好几天后重启，发现zabbix web前端无法访问，提示数据库方面问题。</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@appliance mysql<span style="color:#f92672">]</span><span style="color:#75715e"># systemctl status mysqld</span>
● mysqld.service - MySQL 8.0 database server
   Loaded: loaded <span style="color:#f92672">(</span>/usr/lib/systemd/system/mysqld.service<span style="color:#111">;</span> enabled<span style="color:#111">;</span> vendor preset: disabled<span style="color:#f92672">)</span>
  Drop-In: /etc/systemd/system/mysqld.service.d
           └─override.conf
   Active: failed <span style="color:#f92672">(</span>Result: exit-code<span style="color:#f92672">)</span> since Mon 2024-01-29 06:21:09 CST<span style="color:#111">;</span> 4h 20min ago
  Process: <span style="color:#ae81ff">1095</span> <span style="color:#111">ExecStopPost</span><span style="color:#f92672">=</span>/usr/libexec/mysql-wait-stop <span style="color:#f92672">(</span><span style="color:#111">code</span><span style="color:#f92672">=</span>exited, <span style="color:#111">status</span><span style="color:#f92672">=</span>0/SUCCESS<span style="color:#f92672">)</span>
  Process: <span style="color:#ae81ff">1049</span> <span style="color:#111">ExecStart</span><span style="color:#f92672">=</span>/usr/libexec/mysqld --basedir<span style="color:#f92672">=</span>/usr <span style="color:#f92672">(</span><span style="color:#111">code</span><span style="color:#f92672">=</span>exited, <span style="color:#111">status</span><span style="color:#f92672">=</span>1/FAILURE<span style="color:#f92672">)</span>
  Process: <span style="color:#ae81ff">995</span> <span style="color:#111">ExecStartPre</span><span style="color:#f92672">=</span>/usr/libexec/mysql-prepare-db-dir mysqld.service <span style="color:#f92672">(</span><span style="color:#111">code</span><span style="color:#f92672">=</span>exited, <span style="color:#111">status</span><span style="color:#f92672">=</span>0/SUCCESS<span style="color:#f92672">)</span>
  Process: <span style="color:#ae81ff">950</span> <span style="color:#111">ExecStartPre</span><span style="color:#f92672">=</span>/usr/libexec/mysql-check-socket <span style="color:#f92672">(</span><span style="color:#111">code</span><span style="color:#f92672">=</span>exited, <span style="color:#111">status</span><span style="color:#f92672">=</span>0/SUCCESS<span style="color:#f92672">)</span>
 Main PID: <span style="color:#ae81ff">1049</span> <span style="color:#f92672">(</span><span style="color:#111">code</span><span style="color:#f92672">=</span>exited, <span style="color:#111">status</span><span style="color:#f92672">=</span>1/FAILURE<span style="color:#f92672">)</span>
   Status: <span style="color:#d88200">&#34;Server shutdown complete&#34;</span>
    Error: <span style="color:#ae81ff">17</span> <span style="color:#f92672">(</span>File exists<span style="color:#f92672">)</span>

Jan <span style="color:#ae81ff">29</span> 06:20:58 appliance systemd<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span>: Starting MySQL 8.0 database server...
Jan <span style="color:#ae81ff">29</span> 06:20:58 appliance mysql-check-socket<span style="color:#f92672">[</span>950<span style="color:#f92672">]</span>: Socket file /var/lib/mysql/mysql.sock exists.
Jan <span style="color:#ae81ff">29</span> 06:20:58 appliance mysql-check-socket<span style="color:#f92672">[</span>950<span style="color:#f92672">]</span>: No process is using /var/lib/mysql/mysql.sock, which means it is a garbag
Jan <span style="color:#ae81ff">29</span> 06:21:09 appliance systemd<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span>: mysqld.service: Main process exited, <span style="color:#111">code</span><span style="color:#f92672">=</span>exited, <span style="color:#111">status</span><span style="color:#f92672">=</span>1/FAILURE
Jan <span style="color:#ae81ff">29</span> 06:21:09 appliance systemd<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span>: mysqld.service: Failed with result <span style="color:#d88200">&#39;exit-code&#39;</span>.
Jan <span style="color:#ae81ff">29</span> 06:21:09 appliance systemd<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span>: Failed to start MySQL 8.0 database server.
</code></pre></td></tr></table>
</div>
</div><p>存在<code>/var/lib/mysql/mysqlsock</code>文件，mysql服务没起来，原因未知，删除该文件后，重启mysql数据库，业务恢复正常。</p>
<h3 id="默认密码">默认密码</h3>
<p>到这一步，其实已经可以使用了，只是为了安全考虑，Zabbix Appliance 安装过程中使用的下列密码和配置还需要修改一下。</p>
<p>Zabbix系统：</p>
<ul>
<li>
<p>root:zabbix</p>
<p>ssh登录系统后直接运行<code>passwd</code>命令就可以修改root用户密码。</p>
</li>
</ul>
<p>Zabbix 前端：</p>
<ul>
<li>
<p>Admin:zabbix</p>
<p>直接登录web前端就可以修改。</p>
</li>
</ul>
<p>数据库：</p>
<ul>
<li>root:<random></li>
<li>zabbix:<random></li>
</ul>
<p>此处官方文档里说数据库密码是在安装过程中随机生成的（也就是说不用改应该也没事），Root 密码存储在 /root/.my.cnf 文件中，不需要在 &ldquo;root&rdquo; 用户下输入密码。但我在本地虚拟机环境测试的时候，没有发现 /root/.my.cnf 文件。</p>
<p>要更改数据库用户密码，必须在以下位置同时改变配置：</p>
<ul>
<li>MySQL;</li>
<li>/etc/zabbix/zabbix_server.conf;</li>
<li>/etc/zabbix/web/zabbix.conf.php.</li>
</ul>
<p>大致看了下配置文件和数据库，web前端和后端使用的不同的mysql帐号，密码也确实是一长串的随机字符串。至于mysql具体改密码步骤过程改日再补充。</p>
<h3 id="磁盘管理">磁盘管理</h3>
<p>zabbix appliance安装，默认的磁盘空间好像只有10G，我在本地虚拟机测试的时候，修改为了20G，完成上述基本配置的时候，磁盘分区挂载及空间使用率是这样的：</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@appliance ~<span style="color:#f92672">]</span><span style="color:#75715e"># fdisk -l</span>
Disk /dev/sda: <span style="color:#ae81ff">20</span> GiB, <span style="color:#ae81ff">21474836480</span> bytes, <span style="color:#ae81ff">41943040</span> sectors
Units: sectors of <span style="color:#ae81ff">1</span> * <span style="color:#111">512</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">512</span> bytes
Sector size <span style="color:#f92672">(</span>logical/physical<span style="color:#f92672">)</span>: <span style="color:#ae81ff">512</span> bytes / <span style="color:#ae81ff">512</span> bytes
I/O size <span style="color:#f92672">(</span>minimum/optimal<span style="color:#f92672">)</span>: <span style="color:#ae81ff">512</span> bytes / <span style="color:#ae81ff">512</span> bytes
Disklabel type: dos
Disk identifier: 0x3da27484

Device     Boot    Start      End Sectors  Size Id Type
/dev/sda1  *        <span style="color:#ae81ff">2048</span>  <span style="color:#ae81ff">1050623</span> <span style="color:#ae81ff">1048576</span>  512M <span style="color:#ae81ff">83</span> Linux
/dev/sda2        <span style="color:#ae81ff">1050624</span>  <span style="color:#ae81ff">9439231</span> <span style="color:#ae81ff">8388608</span>    4G <span style="color:#ae81ff">83</span> Linux
/dev/sda3        <span style="color:#ae81ff">9439232</span> <span style="color:#ae81ff">11536383</span> <span style="color:#ae81ff">2097152</span>    1G <span style="color:#ae81ff">83</span> Linux
/dev/sda4       <span style="color:#ae81ff">11536384</span> <span style="color:#ae81ff">20971519</span> <span style="color:#ae81ff">9435136</span>  4.5G  <span style="color:#ae81ff">5</span> Extended
/dev/sda5       <span style="color:#ae81ff">11538432</span> <span style="color:#ae81ff">20971519</span> <span style="color:#ae81ff">9433088</span>  4.5G <span style="color:#ae81ff">83</span> Linux
<span style="color:#f92672">[</span>root@appliance ~<span style="color:#f92672">]</span>#
<span style="color:#f92672">[</span>root@appliance ~<span style="color:#f92672">]</span><span style="color:#75715e"># df -h</span>
Filesystem      Size  Used Avail Use% Mounted on
devtmpfs        1.9G     <span style="color:#ae81ff">0</span>  1.9G   0% /dev
tmpfs           1.9G     <span style="color:#ae81ff">0</span>  1.9G   0% /dev/shm
tmpfs           1.9G   25M  1.9G   2% /run
tmpfs           1.9G     <span style="color:#ae81ff">0</span>  1.9G   0% /sys/fs/cgroup
/dev/sda2       4.0G  1.1G  3.0G  26% /
/dev/sda3      1014M   40M  975M   4% /tmp
/dev/sda5       4.5G  1.2G  3.4G  26% /var/lib/mysql
/dev/sda1       488M   50M  403M  11% /boot
tmpfs           388M     <span style="color:#ae81ff">0</span>  388M   0% /run/user/0
</code></pre></td></tr></table>
</div>
</div><p>在实际使用过程中，随着zabbix的长期运行，有些日志文件、数据库文件、web前端缓存文件等会越来越大，需要保证有足够的磁盘容量用于存放这些数据。部分文件的默认路径：</p>
<ul>
<li>日志：<code>/var/log/zabbix</code></li>
<li>数据库：<code>/var/lib/mysql/</code></li>
<li>web前端缓存：<code>/var/cache/apache2/</code></li>
</ul>
<p>两厢一对比可以发现，<code>/var</code>并没有单独挂载分区，为了防止日志、缓存爆盘，可以通过zabbix的web前端界面调整数据保留策略，位置是<strong>管理-&gt;一般-&gt;管家</strong>和<strong>管理-&gt;一般-&gt;审计日志</strong>；也可以再添加一块磁盘，并挂载给<code>/var/log</code>或者<code>/var</code>使用，具体分区、挂载等操作可参考<a href="/it/linux_fdisk/">linux系统磁盘分区挂载与格式化</a>、<a href="/it/linux_lvm/">linux lvm磁盘管理</a>。或者在一开始的时候，根据实际生产环境预估一下，将磁盘空间修改得更大一些，比如直接改为500G，那应该能给<code>/var/lib/mysql</code>创建个200G以上的独立挂载空间吧。</p>
<p><strong>实际运行一阵子后补充</strong>：上线生产环境的时候新增了两块磁盘，分别挂载给<code>/var</code>和替换原来的<code>/var/lib/mysql</code>，zabbix系统配置添加了一些交换机监控，使用一段时间后，<strong><u>日志和缓存增长并不快，但mysql数据库膨胀比较快</u></strong>，可能是数据保留期限配置得还比较长、未配置及时清理无用监控项等有关系，后续看情况继续完善，并摸索zabbix的使用功能。</p>
<p>
        <a data-fancybox="gallery" href="http://img.xy-ylr.cn/picgo/picgo-clipboard-images/2024-0412-013504-eff75357a236260c36674c9d790bb378-31b3cf.png">
            <img class="mx-auto" alt="磁盘使用情况" src="http://img.xy-ylr.cn/picgo/picgo-clipboard-images/2024-0412-013504-eff75357a236260c36674c9d790bb378-31b3cf.png" />
        </a>
    </p>
<p><code>/var/lib/mysql</code>重新挂载比较简单，先停止运行mysql数据库，将数据临时备份到别的地方（比如临时挂载的/temp分区，使用<code>rsync</code>同步过去或者<code>mv</code>移动过去），再为<code>/var/lib/mysql</code>重新挂载大容量lvm分区，方便后面可以继续扩容，然后再把数据重新迁移回来。</p>
<p><code>/var</code>重新挂载会稍微麻烦一点，<a href="https://chatglm.cn/share/FoY6r">尽量确认<code>/var</code>目录相关的服务都已停止</a>，然后备份恢复的时候需要跳过<code>/var/lib/mysql</code>子目录，参考<a href="https://chatglm.cn/share/FoY6o">备份目录的时候，如何跳过某个子目录 →点击查看智谱清言的回答</a>。</p>
<h2 id="添加主机监控">添加主机监控</h2>
<p>既然zabbix作为一款运维监控工具，安装完成后，自然是要添加主机进行监控。在web页面点击<strong>监测-&gt;主机</strong>或者<strong>配置-&gt;主机</strong>，页面右上角的<strong>创建主机</strong>，都可以开始添加主机。</p>
<p>以添加华为交换机为例，大致操作如下：</p>
<p>填写主机名称、选择主机群组、添加主机接口选择snmp并填写IP地址和团体字等参数。主机端的snmp配置参考<a href="/it/snmp/">SNMP基础</a>。</p>
<p>理论上这样就将主机添加进来了，但是此时基本上看不到关于这台交换机的任何信息，因为我们并没有配置具体的监控项，比如获取交换机的cpu使用率信息。</p>
<p>手动配置监控项及触发器等获取交换机的各种信息比较麻烦，而当有一批同类型的设备需要添加监控，全部手动配置监控项、触发器等内容的时候，更是烦上加烦。万幸，华为是大厂，zabbix有关于配置监控华为网络设备的模板(Huawei VRP by SNMP)。所谓模板，可以理解为我们监控某一类型的主机时候，都会去配置的监控项、触发器等的集合。</p>
<p>所以我们在群组部分选择<code>Templates/Network devices</code>（也可以再选择其他群组），然后模板部分搜索选择<code>Huawei VRP by SNMP</code>，如下截图所示。</p>
<p>
        <a data-fancybox="gallery" href="http://img.xy-ylr.cn/picgo/picgo-clipboard-images/2024-0127-153926-efea0850bce67b466f4ab404cda454a3-842fcd.png">
            <img class="mx-auto" alt="zabbix添加主机监控" src="http://img.xy-ylr.cn/picgo/picgo-clipboard-images/2024-0127-153926-efea0850bce67b466f4ab404cda454a3-842fcd.png" />
        </a>
    </p>
<p>过一会儿我们就能在<strong>监测-&gt;最新数据</strong>页面中看到关于这台交换机的一些信息了。</p>
<h2 id="配置模板">配置模板</h2>
<p>大部分常见设备或应用的监控，zabbix官方都提供了模板，我们在添加监控的时候，只需要选择正确的模板就可以了。</p>
<p>但是实际使用的时候，可能我们并不需要监控那么多信息；又或者我们想要监控的某些信息模板里没有，又或者直接就没有模板，那就需要我们自定义模板，或者对现有模板进行二次调整。</p>
<p>下面以修改华三模板<code>HP Comware HH3C by SNMP</code>为例，对于模板、监控项、触发器等略作说明。</p>
<p>首先在<strong>配置-&gt;模板</strong>页面中找到<code>HP Comware HH3C by SNMP</code>这个模板，点进去，选择<strong>全克隆</strong>，再重命名为<code>H3C Comware by SNMP Custom</code>，最后点击添加，列表里就会多出来一个新的模板。</p>
<p>
        <a data-fancybox="gallery" href="http://img.xy-ylr.cn/picgo/picgo-clipboard-images/2024-0128-170355-722bca22e2b2299d6f054b74167d0edd-df040a.png">
            <img class="mx-auto" alt="全克隆H3C模板" src="http://img.xy-ylr.cn/picgo/picgo-clipboard-images/2024-0128-170355-722bca22e2b2299d6f054b74167d0edd-df040a.png" />
        </a>
    </p>
<p>然后对于监控项、自动发现规则里的监控项原型，有些数据信息比如<code>system.name</code>、<code>system.description</code>、<code>Hardware serial number</code>等交换机基础信息，要么是一次更改后基本就不会再有改动，要么根本就不会去改动，但是模板默认配置却是间隔15分钟、1小时就要获取一次，尤其是自动发现规则中的某些监控项原型，可能间隔一两分钟就要运行一次，有些实在是没有必要如此频繁，也没啥必要保留历史记录和趋势。</p>
<p><em>注：zabbix模板如此设置，可能是为了第一次添加主机监控的时候快速生成各大监控项实体。</em></p>
<p>还有模板中定义了一些宏，一部分是匹配触发器用到的告警阈值，比如cpu使用率过高<code>{$CPU.UTIL.CRIT}</code>、设备温度过高<code>{$TEMP_CRIT}</code>之类的，</p>
<p>我们可以对它们做一些调整，免得过于浪费系统资源、网络带宽，频繁触发告警。</p>
<h2 id="自动发现主机">自动发现主机</h2>
<p>当我们的网络中有很多的交换机需要监控的时候，全部手动添加，就会显得比较烦琐，这个时候就可以使用<strong>网络自动发现</strong>功能。</p>
<p>假设我们的交换机都有配置一个192.168.120.0/24段的IP地址，那我们就可以创建如下的一个自动发现规则：</p>
<p>
        <a data-fancybox="gallery" href="http://img.xy-ylr.cn/picgo/picgo-clipboard-images/2024-0415-142850-cd6c729e93fa3e2382e2fbdf1f5ac9fb-6dc62b.png">
            <img class="mx-auto" alt="自动发现规则" src="http://img.xy-ylr.cn/picgo/picgo-clipboard-images/2024-0415-142850-cd6c729e93fa3e2382e2fbdf1f5ac9fb-6dc62b.png" />
        </a>
    </p>
<ul>
<li>
<p>IP范围根据实际情况来写。</p>
</li>
<li>
<p>在刚开始添加的时候，更新间隔可以设置的稍微短点，比如5分钟，等运行过几轮，确认要监控的设备都已经添加进来之后，可以停用，或者更新间隔改为1d，每天运行一次，看是否有新设备上架。</p>
</li>
<li>
<p>检查里有3个选项，ICMP ping是为了确认IP是否已分配使用。另外两个是获取设备名称<code>.1.3.6.1.2.1.1.1.0</code>和设备描述<code>.1.3.6.1.2.1.1.5.0</code>，这里是直接用的OID，其实也可以换成文本形式<code>sysName</code>和<code>sysDesc</code>，community团体字由交换机上配置，参考<a href="/it/snmp/#%E5%8D%8E%E4%B8%BA%E5%8D%8E%E4%B8%89%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%85%8D%E7%BD%AEsnmp">华为华三交换机配置snmp</a>。</p>
<p>
        <a data-fancybox="gallery" href="http://img.xy-ylr.cn/picgo/picgo-clipboard-images/2024-0415-144438-c78c3d38cdc283cbcfe6bf766a988672-b7fc1d.png">
            <img class="mx-auto" alt="SNMPv2自动发现检查" src="http://img.xy-ylr.cn/picgo/picgo-clipboard-images/2024-0415-144438-c78c3d38cdc283cbcfe6bf766a988672-b7fc1d.png" />
        </a>
    </p>
</li>
</ul>
<h3 id="关联动作">关联动作</h3>
<p>只是配置自动发现其实只能发现主机，还要配置相应的动作才能自动添加主机监控。</p>
<p>点击<strong>配置</strong>-&gt;<strong>动作</strong>-&gt;<strong>发现动作</strong>，然后<strong>创建动作</strong>，如下配置动作和操作，就可以<strong>自动添加华为的网络设备</strong>：</p>
<p>
        <a data-fancybox="gallery" href="http://img.xy-ylr.cn/picgo/picgo-clipboard-images/2024-0415-145930-cc08e116862f47929514cc0da1546875-70511f.png">
            <img class="mx-auto" alt="配置动作" src="http://img.xy-ylr.cn/picgo/picgo-clipboard-images/2024-0415-145930-cc08e116862f47929514cc0da1546875-70511f.png" />
        </a>
    </p>
<p>
        <a data-fancybox="gallery" href="http://img.xy-ylr.cn/picgo/picgo-clipboard-images/2024-0415-150001-806f6a5de8d21e5d583ee675cb38c9dc-986d44.png">
            <img class="mx-auto" alt="配置操作" src="http://img.xy-ylr.cn/picgo/picgo-clipboard-images/2024-0415-150001-806f6a5de8d21e5d583ee675cb38c9dc-986d44.png" />
        </a>
    </p>
<ul>
<li>动作里的<code>计算方式</code>要选择<strong>同时满足</strong>，条件A是<code>自动发现规则</code>关联之前创建的自动发现规则；同时再绑定一个判断条件B：<code>接收到的值</code>包含 <code>Huawei</code>，这个来自于之前创建的自动发现规则中的<code>sysDesc</code>选项，可以通过mib浏览器或者zabbix系统后台使用<code>snmpwalk</code>命令查看信息，参考<a href="/it/snmp">snmp基础配置</a>；条件C应该可以不要，因为A的自动发现规则里已经有IP范围了。</li>
<li>操作是<code>添加到主机</code>、<code>添加到主机群组</code>、<code>链接到模板</code>。</li>
</ul>
<p>这样一来就自动把我们想要监控的华为设备添加进来，并完成基础配置。只要同一类型的设备够多，通过自动发现来添加监控，就会比手动添加主机监控轻松方便快捷。参考上述操作，只要修改<code>接收到的值</code>所包含的内容，我们也可以把H3C的设备、linux服务器、windows服务器等其他品牌或者类型的东西弄进来监控。</p>
<p>在<strong>检测</strong>-&gt;<strong>自动发现</strong>处，可以看到已发现设备列表，边上还有一列是已检测的主机，可以很轻松的确认是否所有设备都已检测成功。</p>
<h2 id="补充配置">补充配置</h2>
<h3 id="自动发现进程和缓存">自动发现进程和缓存</h3>
<p>通过appliance安装zabbix，1. 默认自动发现进程只有一个，如果自动发现的主机比较多，可能会忙不过来。2. 监控的主机数量多起来后，监控项、触发器等数据都需要一定的缓存空间，调整<code>/etc/zabbix/zabbix_server.conf</code>中的相关配置：</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># 调整StartDiscoverers参数，自动发现进程数量，大概280行</span>
<span style="color:#111">StartDiscoverers</span><span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>
<span style="color:#75715e"># 调整CacheSize参数，缓存容量，大概446行</span>
<span style="color:#111">CacheSize</span><span style="color:#f92672">=</span>1G
<span style="color:#75715e"># 历史数据缓存 大概471行</span>
<span style="color:#111">HistoryCacheSize</span><span style="color:#f92672">=</span>512M
<span style="color:#75715e"># 趋势数据缓存 大概489行</span>
<span style="color:#111">TrendCacheSize</span><span style="color:#f92672">=</span>256M
</code></pre></td></tr></table>
</div>
</div><p>web界面可能出现的告警提示：</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># 自动发现程序的利用率超过75%</span>
utilization of discoverer processes over 75%
<span style="color:#75715e"># 缓存不足</span>
Zabbix value cache working in low memory mode
<span style="color:#75715e"># zabbix_server.log也提示缓存不足请增加CacheSize配置参数</span>
value cache is fully used: please increase CacheSize configuration parameter
</code></pre></td></tr></table>
</div>
</div>
        </div>

        
<div class="post-archive">
    <ul class="post-copyright">
        <li><strong>原文作者：</strong><a rel="author" href="https://xy-ylr.github.io">四十荀</a></li>
        <li style="word-break:break-all"><strong>原文链接：</strong><a href="https://xy-ylr.github.io/it/linux_install_zabbix/">https://xy-ylr.github.io/it/linux_install_zabbix/</a></li>
        <li><strong>版权声明：</strong>本作品采用<a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可，非商业转载请注明出处（作者，原文链接），商业转载请联系作者获得授权。</li>
    </ul>
</div>
<br/>



        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/it/linux_ssh/">Linux禁用root远程登录</a></li>
        
        <li><a href="/it/linux_commands/">Linux常用命令笔记</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='/tags/linux'>linux</a></li>
                
                <li><a href='/tags/zabbix'>zabbix</a></li>
                
                <li><a href='/tags/%E8%BF%90%E7%BB%B4'>运维</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "xy-ylr/blog-comments"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
    
    

</div>

                    <footer id="footer">
    <div>
        &copy; 2024 <a href="https://xy-ylr.github.io">四十荀的博客 By 四十荀</a>
        
        | <a rel="nofollow" target="_blank" href="http://beian.miit.gov.cn/">浙ICP备2023002264号-1</a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://www.flysnow.org/" target="_black"><span class="badge-subject">Design by</span><span class="badge-value bg-brightgreen">飞雪无情</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
</footer>


    
    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script><script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>
    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://xy-ylr.github.io/search' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://xy-ylr.github.io">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://xy-ylr.github.io/it/kali_configure_openvas/" title="Kali2024.1安装配置openvas(gvm)漏洞扫描软件">Kali2024.1安装配置openvas(gvm)漏洞扫描软件</a>
    </li>
    
    <li>
        <a href="https://xy-ylr.github.io/it/linux_iso2local_yum/" title="Linux使用iso镜像制作本地源">Linux使用iso镜像制作本地源</a>
    </li>
    
    <li>
        <a href="https://xy-ylr.github.io/it/vmware_patches_updates/" title="Vmware更新补丁方法">Vmware更新补丁方法</a>
    </li>
    
    <li>
        <a href="https://xy-ylr.github.io/it/zabbix_snmp_trap/" title="Zabbix配置snmp trap接收主动告警">Zabbix配置snmp trap接收主动告警</a>
    </li>
    
    <li>
        <a href="https://xy-ylr.github.io/it/vlmcsd_kms/" title="利用VLMCSD部署本地KMS服务器">利用VLMCSD部署本地KMS服务器</a>
    </li>
    
    <li>
        <a href="https://xy-ylr.github.io/it/snmp/" title="SNMP基础">SNMP基础</a>
    </li>
    
    <li>
        <a href="https://xy-ylr.github.io/it/huawei_css/" title="华为交换机STACK堆叠与CSS集群配置">华为交换机STACK堆叠与CSS集群配置</a>
    </li>
    
    <li>
        <a href="https://xy-ylr.github.io/it/h3c_complex_nat/" title="H3c防火墙双向地址转换配置">H3c防火墙双向地址转换配置</a>
    </li>
    
    <li>
        <a href="https://xy-ylr.github.io/it/h3c_snat/" title="H3c防火墙源地址转换配置">H3c防火墙源地址转换配置</a>
    </li>
    
    <li>
        <a href="https://xy-ylr.github.io/it/h3c_network_nat/" title="H3C防火墙NAT配置">H3C防火墙NAT配置</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href='/categories/'>分类</a></h3>
<ul class="widget-list">
    
    <li><a href="https://xy-ylr.github.io/categories/Windows/">Windows (1)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/debian/">debian (1)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/git/">git (4)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/linux/">linux (9)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/office%E5%8A%9E%E5%85%AC/">office办公 (1)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/snmp/">snmp (1)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/vmware/">vmware (1)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/zabbix/">zabbix (2)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/%E5%81%A5%E8%BA%AB/">健身 (1)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/%E5%86%9C%E4%B8%9A/">农业 (1)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/%E7%90%86%E8%B4%A2/">理财 (1)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/%E7%BC%96%E8%BE%91/">编辑 (3)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/%E7%BD%91%E7%BB%9C/">网络 (11)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/%E8%BF%90%E7%BB%B4/">运维 (2)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/tags/'>标签</a></h3>
<div class="tagcloud">
    
    <a href="https://xy-ylr.github.io/tags/DHCP/">DHCP</a>
    
    <a href="https://xy-ylr.github.io/tags/alias/">alias</a>
    
    <a href="https://xy-ylr.github.io/tags/apt/">apt</a>
    
    <a href="https://xy-ylr.github.io/tags/bash-shell/">bash shell</a>
    
    <a href="https://xy-ylr.github.io/tags/css%E9%9B%86%E7%BE%A4/">css集群</a>
    
    <a href="https://xy-ylr.github.io/tags/debian/">debian</a>
    
    <a href="https://xy-ylr.github.io/tags/dnf/">dnf</a>
    
    <a href="https://xy-ylr.github.io/tags/excel/">excel</a>
    
    <a href="https://xy-ylr.github.io/tags/firewalld/">firewalld</a>
    
    <a href="https://xy-ylr.github.io/tags/git/">git</a>
    
    <a href="https://xy-ylr.github.io/tags/github/">github</a>
    
    <a href="https://xy-ylr.github.io/tags/h3c/">h3c</a>
    
    <a href="https://xy-ylr.github.io/tags/h3c%E9%98%B2%E7%81%AB%E5%A2%99/">h3c防火墙</a>
    
    <a href="https://xy-ylr.github.io/tags/hugo/">hugo</a>
    
    <a href="https://xy-ylr.github.io/tags/irf/">irf</a>
    
    <a href="https://xy-ylr.github.io/tags/kali/">kali</a>
    
    <a href="https://xy-ylr.github.io/tags/kms%E6%BF%80%E6%B4%BB/">kms激活</a>
    
    <a href="https://xy-ylr.github.io/tags/linux/">linux</a>
    
    <a href="https://xy-ylr.github.io/tags/lvm/">lvm</a>
    
    <a href="https://xy-ylr.github.io/tags/nat/">nat</a>
    
    <a href="https://xy-ylr.github.io/tags/nat%E9%85%8D%E7%BD%AE/">nat配置</a>
    
    <a href="https://xy-ylr.github.io/tags/network/">network</a>
    
    <a href="https://xy-ylr.github.io/tags/openvasgvm/">openvas(gvm)</a>
    
    <a href="https://xy-ylr.github.io/tags/patch-update/">patch update</a>
    
    <a href="https://xy-ylr.github.io/tags/rime/">rime</a>
    
    <a href="https://xy-ylr.github.io/tags/selinux/">selinux</a>
    
    <a href="https://xy-ylr.github.io/tags/snmp/">snmp</a>
    
    <a href="https://xy-ylr.github.io/tags/snmp-trap/">snmp trap</a>
    
    <a href="https://xy-ylr.github.io/tags/ssh/">ssh</a>
    
    <a href="https://xy-ylr.github.io/tags/sudo/">sudo</a>
    
    <a href="https://xy-ylr.github.io/tags/typora/">typora</a>
    
    <a href="https://xy-ylr.github.io/tags/vmware/">vmware</a>
    
    <a href="https://xy-ylr.github.io/tags/windows%E6%BF%80%E6%B4%BB/">windows激活</a>
    
    <a href="https://xy-ylr.github.io/tags/yum/">yum</a>
    
    <a href="https://xy-ylr.github.io/tags/zabbix/">zabbix</a>
    
    <a href="https://xy-ylr.github.io/tags/%E5%81%A5%E8%BA%AB/">健身</a>
    
    <a href="https://xy-ylr.github.io/tags/%E5%86%9C%E4%B8%9A/">农业</a>
    
    <a href="https://xy-ylr.github.io/tags/%E5%88%86%E5%8C%BA/">分区</a>
    
    <a href="https://xy-ylr.github.io/tags/%E5%8D%8E%E4%B8%BA/">华为</a>
    
    <a href="https://xy-ylr.github.io/tags/%E6%8C%82%E8%BD%BD/">挂载</a>
    
    <a href="https://xy-ylr.github.io/tags/%E6%A0%BC%E5%BC%8F%E5%8C%96/">格式化</a>
    
    <a href="https://xy-ylr.github.io/tags/%E6%BC%8F%E6%89%AB/">漏扫</a>
    
    <a href="https://xy-ylr.github.io/tags/%E7%82%92%E8%82%A1/">炒股</a>
    
    <a href="https://xy-ylr.github.io/tags/%E7%90%86%E8%B4%A2/">理财</a>
    
    <a href="https://xy-ylr.github.io/tags/%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86/">磁盘管理</a>
    
    <a href="https://xy-ylr.github.io/tags/%E7%BD%91%E7%BB%9C/">网络</a>
    
    <a href="https://xy-ylr.github.io/tags/%E7%BD%91%E7%BB%9C-MSTP/">网络, MSTP</a>
    
    <a href="https://xy-ylr.github.io/tags/%E7%BD%91%E7%BB%9C%E4%B8%A2%E5%8C%85/">网络丢包</a>
    
    <a href="https://xy-ylr.github.io/tags/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%B8%88/">网络工程师</a>
    
    <a href="https://xy-ylr.github.io/tags/%E7%BD%91%E7%BB%9C%E6%8E%92%E9%9A%9C/">网络排障</a>
    
    <a href="https://xy-ylr.github.io/tags/%E7%BD%91%E7%BB%9C%E7%8E%AF%E8%B7%AF/">网络环路</a>
    
    <a href="https://xy-ylr.github.io/tags/%E8%BF%90%E7%BB%B4/">运维</a>
    
</div>
    </section>

    
<section class="widget">
    <h3 class="widget-title">友情链接</h3>
    <ul class="widget-list">
        
        <li>
            <a target="_blank" href="https://www.flysnow.org/" title="飞雪无情的博客">飞雪无情的博客</a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://xy-ylr.github.io/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>

</html>