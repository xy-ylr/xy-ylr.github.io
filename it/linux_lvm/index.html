<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    

    <title>Linux lvm磁盘管理 | 四十荀的博客</title>
    <meta property="og:title" content="Linux lvm磁盘管理 - 四十荀的博客">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2022-12-02T09:31:57&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2022-12-02T09:31:57&#43;08:00'>
        
    <meta name="Keywords" content="四十荀,xy-ylr,python,linux,未来新农人,偶尔骑行或健身^_^">
    <meta name="description" content="Linux lvm磁盘管理">
        
    <meta name="author" content="四十荀">
    <meta property="og:url" content="https://xy-ylr.github.io/it/linux_lvm/">
    <link rel="shortcut icon" href='/favicon.ico'  type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
        <link href="https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" rel="stylesheet">
    
    
    
    
</head>

<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://xy-ylr.github.io">
                        四十荀的博客
                    </a>
                
                <p class="description">运维工程师, 未来新农人, 间歇性运动</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="" href="https://xy-ylr.github.io">首页</a>
                    
                    <a  href="https://xy-ylr.github.io/it/" title="计算机">计算机</a>
                    
                    <a  href="https://xy-ylr.github.io/licai/" title="理财">理财</a>
                    
                    <a  href="https://xy-ylr.github.io/nongye/" title="农业">农业</a>
                    
                    <a  href="https://xy-ylr.github.io/yundong/" title="健身">健身</a>
                    
                    <a  href="https://xy-ylr.github.io/archives/" title="归档">归档</a>
                    
                    <a  href="https://xy-ylr.github.io/about/" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    <style type="text/css">
    .post-toc {
        position: fixed;
        width: 200px;
        margin-left: -230px;
        padding: 5px 10px;
        font-family: Athelas, STHeiti, Microsoft Yahei, serif;
        font-size: 12px;
        border: 1px solid rgba(0, 0, 0, .07);
        border-radius: 5px;
        background-color: rgba(255, 255, 255, 0.98);
        background-clip: padding-box;
        -webkit-box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        word-wrap: break-word;
         
         
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        z-index: 999;
        cursor: pointer;
        max-height: 70%;
        overflow-y: auto;
        overflow-x: hidden;
    }

    .post-toc .post-toc-title {
        width: 100%;
        margin: 0 auto;
        font-size: 20px;
        font-weight: 400;
        text-transform: uppercase;
        text-align: center;
    }

    .post-toc .post-toc-content {
        font-size: 15px;
    }

    .post-toc .post-toc-content>nav>ul {
        margin: 10px 0;
    }

    .post-toc .post-toc-content ul {
        padding-left: 20px;
        list-style: square;
        margin: 0.5em;
        line-height: 1.8em;
    }

    .post-toc .post-toc-content ul ul {
        padding-left: 15px;
         
         
    }

    @media print,
    screen and (max-width:1057px) {
        .post-toc {
            display: none;
        }
    }
</style>
<div class="post-toc" style="position: absolute; top: 188px;">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#lvm基础">LVM基础</a>
      <ul>
        <li><a href="#pv">PV</a></li>
        <li><a href="#vg">VG</a></li>
        <li><a href="#lv">LV</a></li>
        <li><a href="#pe">PE</a></li>
      </ul>
    </li>
    <li><a href="#模拟">模拟</a>
      <ul>
        <li><a href="#创建lvm分区">创建LVM分区</a></li>
        <li><a href="#lvm扩容">LVM扩容</a></li>
        <li><a href="#lvm缩小">LVM缩小</a></li>
        <li><a href="#lvm精简置备">LVM精简置备</a></li>
        <li><a href="#lvm快照">LVM快照</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function () {
        var postToc = $(".post-toc");
        if (postToc.length) {
            var leftPos = $("#main").offset().left;
            if (leftPos < 220) {
                postToc.css({ "width": leftPos - 10, "margin-left": (0 - leftPos) })
            }

            var t = postToc.offset().top - 20,
                a = {
                    start: {
                        position: "absolute",
                        top: t
                    },
                    process: {
                        position: "fixed",
                        top: 20
                    },
                };
            $(window).scroll(function () {
                var e = $(window).scrollTop();
                e < t ? postToc.css(a.start) : postToc.css(a.process)
            })
        }

        if ($("#TableOfContents").children().length < 1) {
            $(".post-toc").remove();
        }
    })
</script>
    <article class="post">
        <header>
            <h1 class="post-title">Linux lvm磁盘管理</h1>
        </header>
        <date class="post-meta meta-date">
            2022年12月2日
        </date>
        
        <div class="post-meta">
            <span>|</span>
            
            <span class="meta-category"><a href='/categories/linux'>linux</a></span>
            
        </div>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-meta">
            <span>|</span>
            <span> 共约7469字 </span>
            <span> 预计阅读时间15分钟</span>
        </div>
        
        
        <div class="clear" style="display: none">
            <div class="toc-article">
                <div class="toc-title">文章目录</div>
            </div>
        </div>
        
        
        

    
    
    

    
    


<div class="post-outdated">
    
    <div class="warn">
    
        <p>【注意】本文最后更新于 
            <span class="timeago" datetime="2022-12-02T09:31:57" title="2022-12-02">
            2022-12-02
            </span>，文中内容可能已过时，请谨慎使用。
        </p>
    </div>
</div>



        <div class="post-content">
            <p>逻辑卷管理Logical Volume Management（LVM）是一种被广泛使用的技术，它在物理磁盘和文件系统之间增加了一个额外的层，允许你创建一个逻辑卷而不是物理磁盘。对于磁盘管理来说，它是非常灵活的，在需要的时候可以轻松地调整、扩展和减少逻辑卷的大小。</p>
<p>在linux系统中，正常硬盘在创建分区挂载到目录之后，想要再调整分区的大小，会比较麻烦。比如随着系统使用时间的增长，想要将<code>/home</code>分区的大小从100G改为200G，我们可能需要先将整个目录下的数据做个备份，取消原来100G空间的分区挂载，改为挂载200G的分区，然后再将备份的数据拷贝回来。想要缩减容量也类似。</p>
<p>而LVM可以弹性的调整文件系统分区的大小。它在硬盘分区和文件系统之间添加了一个逻辑层，提供一个抽象的卷组概念，可以将多个硬盘在逻辑上组成一个更大的盘，然后再进行分区（创建逻辑卷）。</p>
<h2 id="lvm基础">LVM基础</h2>
<p>几个基本概念：PV（物理卷）、VG（卷组）、LV（逻辑卷）、PE（基本单元）。</p>
<p>简单理解，lvm就像一个公司（VG）建了一幢楼，有很多层（PV）， 每层又有若干个办公室（PE），而实际的部门（LV）根据规模大小可能占了好几层办公楼，也可能只是占了一层中的几个办公室，并且随着公司运行，部门可能扩招或者裁员调整大小（调整LV容量）。当然，随着公司做大做强，一幢楼都不够用了，可能还会再建一幢（扩大VG容量）；也有可能效益不好，把其中几层租出去给别人用（删除一些PV缩小VG容量，另做他用）。</p>
<h3 id="pv">PV</h3>
<p>Physical Volume，物理卷是整个LVM的底层，它本质上可以是一整个未经分区格式化的裸磁盘，也可以是一个单独的分区，或者是raid磁盘阵列。部分命令：</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># 查看当前系统中的pv，显示的信息详细度有区别。默认列出所有pv，如果指定pv名称，就只查看特定的</span>
pvs <span style="color:#f92672">[</span>pa_name<span style="color:#f92672">]</span>
pvscan
pvdisplay <span style="color:#f92672">[</span>pv_name<span style="color:#f92672">]</span>
<span style="color:#75715e"># 将硬盘、分区等创建为pv。</span>
pvcreate <span style="color:#f92672">[</span>/dev/sdb<span style="color:#f92672">]</span>
<span style="color:#75715e"># 删除pv</span>
pvremove 
<span style="color:#75715e"># 在虚拟机中配置，将一块磁盘扩容了，可以通过该命令扩展物理机容量</span>
pvresize <span style="color:#f92672">[</span>pv_name<span style="color:#f92672">]</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>注意</strong>：在将硬盘、分区等转变为PV的时候，原有数据，会被删除。</p>
<h3 id="vg">VG</h3>
<p>Volume Group，若干个PV加在一起就组成了VG，在逻辑层面，就由若干块小容量硬盘，变成了一块大容量硬盘。部分命令：</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># 查看vg，显示的信息详细度有区别。默认列出所有vg</span>
vgs <span style="color:#f92672">[</span>pv_name<span style="color:#f92672">]</span>
vgscan 
vgdisplay <span style="color:#f92672">[</span>pv_name<span style="color:#f92672">]</span>
<span style="color:#75715e"># 将指定的pv创建为指定的vg，可一次性指定多个pv。添加-s参数可修改默认pe大小。</span>
vgcreate <span style="color:#f92672">[</span>-s PE_size<span style="color:#f92672">]</span> vg_name pv_name1<span style="color:#f92672">[</span> pv_name2 …<span style="color:#f92672">]</span>
<span style="color:#75715e"># 将指定pv加入指定vg，为该vg扩容。</span>
vgextend <span style="color:#f92672">[</span>vg_name<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>pv_name<span style="color:#f92672">]</span>
<span style="color:#75715e"># 从指定vg中移除指定pv</span>
vgreduce <span style="color:#f92672">[</span>vg_name<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>pv_name<span style="color:#f92672">]</span>
<span style="color:#75715e"># 删除指定vg，这是删除整个卷组。</span>
vgremove <span style="color:#f92672">[</span>vg_name<span style="color:#f92672">]</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="lv">LV</h3>
<p>Logical Volume，逻辑卷可以理解为常规概念里的分区，就是将VG这个大硬盘划分成若干个分区，然后格式化一下就可以拿来挂载给系统使用了。部分命令：</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># 查看lv，如果要查看指定lv的信息，需要使用完整路径名</span>
lvs <span style="color:#f92672">[</span>/dev/vg_name/lv_name<span style="color:#f92672">]</span>
lvscan
lvdisplay <span style="color:#f92672">[</span>/dev/vg_name/lv_name<span style="color:#f92672">]</span>
<span style="color:#75715e"># 创建lv。-L是以M、G等容量单位创建；小写的-l是以pe数来创建，比如默认pe为4M，要创建100G的，可以指定-l 25000</span>
lvcreate –n <span style="color:#f92672">[</span>lv_name<span style="color:#f92672">]</span> –L <span style="color:#f92672">[</span>100G<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>vg_name<span style="color:#f92672">]</span>
lvcreate –n <span style="color:#f92672">[</span>lv_name<span style="color:#f92672">]</span> –l <span style="color:#f92672">[</span>25000<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>vg_name<span style="color:#f92672">]</span>
<span style="color:#75715e"># lv扩容。-L和-l意义和lvcreate中一样；</span>
<span style="color:#75715e"># 可以使用前缀+，表示增加指定的容量，否则就是将容量修改为指定的值。</span>
lvextend –L <span style="color:#f92672">[</span>+<span style="color:#f92672">][</span>100G<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>lv_name<span style="color:#f92672">]</span>
lvextend –l <span style="color:#f92672">[</span>+<span style="color:#f92672">][</span>25000<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>lv_name<span style="color:#f92672">]</span>
<span style="color:#75715e"># lv缩容。-L和-l和上面的一样;</span>
<span style="color:#75715e"># 如果添加前缀-，表示减少指定值的容量，否则是将容量缩小到指定值。</span>
<span style="color:#75715e"># 减少容量可能造成数据丢失!</span>
lvreduce –L <span style="color:#f92672">[</span>-<span style="color:#f92672">][</span>100G<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>lv_name<span style="color:#f92672">]</span>
lvreduce –l <span style="color:#f92672">[</span>-<span style="color:#f92672">][</span>25000<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>lv_name<span style="color:#f92672">]</span>
<span style="color:#75715e"># 扩容缩容都可以，缩容有风险!</span>
lvresize –L <span style="color:#f92672">[</span>+<span style="color:#111">|</span>-<span style="color:#f92672">][</span>100G<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>lv_name<span style="color:#f92672">]</span>
lvresize –l <span style="color:#f92672">[</span>+<span style="color:#111">|</span>-<span style="color:#f92672">][</span>25000<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>lv_name<span style="color:#f92672">]</span>
<span style="color:#75715e"># 删除一个lv</span>
lvremove <span style="color:#f92672">[</span>lv_name<span style="color:#f92672">]</span>
</code></pre></td></tr></table>
</div>
</div><p>如果使用<code>-l</code>参数来指定lv的容量，可以先用<code>vgdisplay [vgname]</code>查看vg的详细信息，确认下pe的大小、剩余可用pe的个数，然后再计算想要分配的容量需要多少个pe数。</p>
<h3 id="pe">PE</h3>
<p>Physical Extent，可以理解为基本单元，就类似于硬盘里的扇区概念，是LVM中的最小存储区块，默认大小为4M。在逻辑层面，由若干个PE组成LV以及VG，LVM所谓的弹性调整分区大小 其实就是增加或减少LV中的PE数量。</p>
<h2 id="模拟">模拟</h2>
<p>此处以centos7在vmware虚拟机上模拟，使用<code>/dev/sdc</code>下的分区来创建lvm。</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># fdisk -l /dev/sdc</span>

Disk /dev/sdc: 21.5 GB, <span style="color:#ae81ff">21474836480</span> bytes, <span style="color:#ae81ff">41943040</span> sectors
<span style="color:#111">Units</span> <span style="color:#f92672">=</span> sectors of <span style="color:#ae81ff">1</span> * <span style="color:#111">512</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">512</span> bytes
Sector size <span style="color:#f92672">(</span>logical/physical<span style="color:#f92672">)</span>: <span style="color:#ae81ff">512</span> bytes / <span style="color:#ae81ff">512</span> bytes
I/O size <span style="color:#f92672">(</span>minimum/optimal<span style="color:#f92672">)</span>: <span style="color:#ae81ff">512</span> bytes / <span style="color:#ae81ff">512</span> bytes
Disk label type: dos
Disk identifier: 0xe70dcf7e

   Device Boot      Start         End      Blocks   Id  System
/dev/sdc1            <span style="color:#ae81ff">2048</span>    <span style="color:#ae81ff">41943039</span>    <span style="color:#ae81ff">20970496</span>    <span style="color:#ae81ff">5</span>  Extended
/dev/sdc5            <span style="color:#ae81ff">4096</span>     <span style="color:#ae81ff">2101247</span>     <span style="color:#ae81ff">1048576</span>   <span style="color:#ae81ff">83</span>  Linux
/dev/sdc6         <span style="color:#ae81ff">2103296</span>     <span style="color:#ae81ff">6297599</span>     <span style="color:#ae81ff">2097152</span>   <span style="color:#ae81ff">83</span>  Linux
/dev/sdc7         <span style="color:#ae81ff">6299648</span>    <span style="color:#ae81ff">10493951</span>     <span style="color:#ae81ff">2097152</span>   <span style="color:#ae81ff">83</span>  Linux
/dev/sdc8        <span style="color:#ae81ff">10496000</span>    <span style="color:#ae81ff">12593151</span>     <span style="color:#ae81ff">1048576</span>   <span style="color:#ae81ff">83</span>  Linux
/dev/sdc9        <span style="color:#ae81ff">12595200</span>    <span style="color:#ae81ff">18886655</span>     <span style="color:#ae81ff">3145728</span>   <span style="color:#ae81ff">83</span>  Linux
/dev/sdc10       <span style="color:#ae81ff">18888704</span>    <span style="color:#ae81ff">20985855</span>     <span style="color:#ae81ff">1048576</span>   <span style="color:#ae81ff">83</span>  Linux
</code></pre></td></tr></table>
</div>
</div><h3 id="创建lvm分区">创建LVM分区</h3>
<p>现在假设我们的服务器要部署某个业务需要用到mysql数据库，并且我们准备用lvm为mysql创建独立挂载分区用于存放数据。</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># 将sdc5 - sdc8创建为pv</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># pvcreate /dev/sdc{5,6,7,8}</span>
  Physical volume <span style="color:#d88200">&#34;/dev/sdc5&#34;</span> successfully created.
  Physical volume <span style="color:#d88200">&#34;/dev/sdc6&#34;</span> successfully created.
  Physical volume <span style="color:#d88200">&#34;/dev/sdc7&#34;</span> successfully created.
  Physical volume <span style="color:#d88200">&#34;/dev/sdc8&#34;</span> successfully created.
<span style="color:#75715e"># 将4个pv加入vgtest这个卷组</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># vgcreate vgtest /dev/sdc{5,6,7,8}</span>
  Volume group <span style="color:#d88200">&#34;vgtest&#34;</span> successfully created
<span style="color:#75715e"># 创建lv，名称lv_var_mysql，大小1G</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># lvcreate -n lv_var_mysql -L 1G vgtest</span>
  Logical volume <span style="color:#d88200">&#34;lv_var_mysql&#34;</span> created.
<span style="color:#75715e"># 格式化lv分区</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># mkfs.xfs /dev/vgtest/lv_var_mysql</span>
meta-data<span style="color:#f92672">=</span>/dev/vgtest/lv_var_mysql <span style="color:#111">isize</span><span style="color:#f92672">=</span><span style="color:#ae81ff">512</span>    <span style="color:#111">agcount</span><span style="color:#f92672">=</span>4, <span style="color:#111">agsize</span><span style="color:#f92672">=</span><span style="color:#ae81ff">65536</span> <span style="color:#111">blks</span>
         <span style="color:#f92672">=</span>                         <span style="color:#111">sectsz</span><span style="color:#f92672">=</span><span style="color:#ae81ff">512</span>   <span style="color:#111">attr</span><span style="color:#f92672">=</span>2, <span style="color:#111">projid32bit</span><span style="color:#f92672">=</span><span style="color:#111">1</span>
         <span style="color:#f92672">=</span>                         <span style="color:#111">crc</span><span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>        <span style="color:#111">finobt</span><span style="color:#f92672">=</span>0, <span style="color:#111">sparse</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
<span style="color:#111">data</span>     <span style="color:#f92672">=</span>                         <span style="color:#111">bsize</span><span style="color:#f92672">=</span><span style="color:#ae81ff">4096</span>   <span style="color:#111">blocks</span><span style="color:#f92672">=</span>262144, <span style="color:#111">imaxpct</span><span style="color:#f92672">=</span><span style="color:#111">25</span>
         <span style="color:#f92672">=</span>                         <span style="color:#111">sunit</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>      <span style="color:#111">swidth</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> blks
<span style="color:#111">naming</span>   <span style="color:#f92672">=</span>version <span style="color:#ae81ff">2</span>                <span style="color:#111">bsize</span><span style="color:#f92672">=</span><span style="color:#ae81ff">4096</span>   ascii-ci<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> <span style="color:#111">ftype</span><span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
<span style="color:#111">log</span>      <span style="color:#f92672">=</span>internal log             <span style="color:#111">bsize</span><span style="color:#f92672">=</span><span style="color:#ae81ff">4096</span>   <span style="color:#111">blocks</span><span style="color:#f92672">=</span>2560, <span style="color:#111">version</span><span style="color:#f92672">=</span><span style="color:#111">2</span>
         <span style="color:#f92672">=</span>                         <span style="color:#111">sectsz</span><span style="color:#f92672">=</span><span style="color:#ae81ff">512</span>   <span style="color:#111">sunit</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> blks, lazy-count<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
<span style="color:#111">realtime</span> <span style="color:#f92672">=</span>none                     <span style="color:#111">extsz</span><span style="color:#f92672">=</span><span style="color:#ae81ff">4096</span>   <span style="color:#111">blocks</span><span style="color:#f92672">=</span>0, <span style="color:#111">rtextents</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
<span style="color:#75715e"># 创建挂载目录并挂载</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># mkdir /var/mysql</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># mount /dev/vgtest/mysql /var/mysql/</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># df -h /var/mysql/</span>
Filesystem                       Size  Used Avail Use% Mounted on
/dev/mapper/vgtest-lv_var_mysql 1014M   33M  982M   4% /var/mysql
</code></pre></td></tr></table>
</div>
</div><p>经过上述步骤，一个lvm分区就算创建完成，并且成功挂载给<code>/var/mysql</code>目录使用。</p>
<p>其他<code>pvdisplay</code>、<code>vgdisplay</code>、<code>lvdisplay</code>等命令请自行体验。</p>
<h3 id="lvm扩容">LVM扩容</h3>
<p>lvm扩容包括<strong>vg扩容</strong>和<strong>lv扩容</strong>，lv扩容需要lv所属的vg还有可用空间；vg扩容需要新增硬盘、分区等实际存储空间，再将之转换为pv并加入对应的vg。</p>
<p>现在假设经过一段时间使用后，lv_var_mysql分区容量即将用尽，需要为它进行扩容。</p>
<p><strong>扩容LV</strong>：</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># 查看vg剩余可用空间</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># vgdisplay vgtest</span>
  --- Volume group ---
  VG Name               vgtest
  System ID
  Format                lvm2
  Metadata Areas        <span style="color:#ae81ff">4</span>
  Metadata Sequence No  <span style="color:#ae81ff">2</span>
  VG Access             read/write
  VG Status             resizable
  MAX LV                <span style="color:#ae81ff">0</span>
  Cur LV                <span style="color:#ae81ff">1</span>
  Open LV               <span style="color:#ae81ff">1</span>
  Max PV                <span style="color:#ae81ff">0</span>
  Cur PV                <span style="color:#ae81ff">4</span>
  Act PV                <span style="color:#ae81ff">4</span>
  VG Size               5.98 GiB
  PE Size               4.00 MiB
  Total PE              <span style="color:#ae81ff">1532</span>
  Alloc PE / Size       <span style="color:#ae81ff">256</span> / 1.00 GiB
  Free  PE / Size       <span style="color:#ae81ff">1276</span> / 4.98 GiB
  VG UUID               tI2zDR-fCiQ-hzda-4NnJ-mvxV-xcxs-Gjj3eP
<span style="color:#75715e"># 将剩余的4.98G全部分配给lv_var_mysql使用</span>
<span style="color:#75715e"># [root@localhost xy]# lvextend -l 1532 /dev/vgtest/lv_var_mysql</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># lvextend -L +4.98G /dev/vgtest/lv_var_mysql</span>
  Rounding size to boundary between physical extents: 4.98 GiB.
  Size of logical volume vgtest/lv_var_mysql changed from 1.00 GiB <span style="color:#f92672">(</span><span style="color:#ae81ff">256</span> extents<span style="color:#f92672">)</span> to 5.98 GiB <span style="color:#f92672">(</span><span style="color:#ae81ff">1531</span> extents<span style="color:#f92672">)</span>.
  Logical volume vgtest/lv_var_mysql successfully resized.
<span style="color:#75715e"># 查看分区容量</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># lvscan</span>
  ACTIVE            <span style="color:#d88200">&#39;/dev/vgtest/lv_var_mysql&#39;</span> <span style="color:#f92672">[</span>5.98 GiB<span style="color:#f92672">]</span> inherit
<span style="color:#75715e"># 查看文件系统容量</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># df -h /var/mysql/</span>
Filesystem                       Size  Used Avail Use% Mounted on
/dev/mapper/vgtest-lv_var_mysql 1014M   33M  982M   4% /var/mysql
<span style="color:#75715e"># 扩展文件系统（需要根据实际分区格式来）</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># xfs_growfs /var/mysql</span>
</code></pre></td></tr></table>
</div>
</div><p>可以发现，在成功完成lv逻辑卷扩容之后，<code>/var/mysql</code>挂载点的文件系统容量并没有更新，由于之前我们是把lv格式化为xfs格式，所以此处我们使用<code>xfs_growfs</code>。xfs支持直接在线调整容量，所以不用先卸载。</p>
<p>如果是格式化为<code>ext4</code>，需要先<code>umount</code>卸载文件系统，接着运行<code>e2fsck -f /dev/vgtest/lv_var_mysql</code>校验文件系统完整性，然后再运行<code>resize2fs /dev/vgtest/lv_var_mysql</code>来扩展文件系统。</p>
<p><strong>扩容VG</strong>：</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># 创建新的pv</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># pvcreate /dev/sdc9 /dev/sdc10</span>
  Physical volume <span style="color:#d88200">&#34;/dev/sdc9&#34;</span> successfully created.
  Physical volume <span style="color:#d88200">&#34;/dev/sdc10&#34;</span> successfully created.
<span style="color:#75715e"># 将新创建的pv加入vg</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># vgextend vgtest /dev/sdc9 /dev/sdc10</span>
  Volume group <span style="color:#d88200">&#34;vgtest&#34;</span> successfully extended
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># vgdisplay vgtest</span>
  --- Volume group ---
  VG Name               vgtest
  System ID
  Format                lvm2
  Metadata Areas        <span style="color:#ae81ff">6</span>
  Metadata Sequence No  <span style="color:#ae81ff">4</span>
  VG Access             read/write
  VG Status             resizable
  MAX LV                <span style="color:#ae81ff">0</span>
  Cur LV                <span style="color:#ae81ff">1</span>
  Open LV               <span style="color:#ae81ff">1</span>
  Max PV                <span style="color:#ae81ff">0</span>
  Cur PV                <span style="color:#ae81ff">6</span>
  Act PV                <span style="color:#ae81ff">6</span>
  VG Size               &lt;9.98 GiB
  PE Size               4.00 MiB
  Total PE              <span style="color:#ae81ff">2554</span>
  Alloc PE / Size       <span style="color:#ae81ff">1531</span> / 5.98 GiB
  Free  PE / Size       <span style="color:#ae81ff">1023</span> / &lt;4.00 GiB
  VG UUID               tI2zDR-fCiQ-hzda-4NnJ-mvxV-xcxs-Gjj3eP
</code></pre></td></tr></table>
</div>
</div><p>可以看到vg的容量从原来的5.98G变成了9.98G。</p>
<h3 id="lvm缩小">LVM缩小</h3>
<p>目前的个人理解，如果不是空间紧张，又实在没有其他办法增加存储空间（钞能力新增硬盘等），一般情况下不要去搞缩容操作，可能会导致数据损坏。</p>
<p>有选择的情况下或许直接创建一个小容量的lv，重新挂载并把数据迁移过来之后，再直接释放原来的大容量lv，会更好？</p>
<p><strong>xfs格式</strong>的文件系统只能扩容，而不能缩容。要想实现缩容，就得先找地方备份数据，然后再对lv缩容，最后恢复数据；或者就是直接创建一个新的小容量的lv来替换原来大容量的lv。</p>
<p><strong>ext格式</strong>：</p>
<p>假设我们要将刚才配置的lv_var_mysql缩容1G，并将pv(/dev/sdc5)从vg中移除。</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># umount /var/mysql</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># mkfs.ext4 /dev/vgtest/lv_var_mysql</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># mount /dev/vgtest/lv_var_mysql /var/mysql/</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># cp -r /usr/ /var/mysql/</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># df -BM /dev/vgtest/lv_var_mysql</span>
Filesystem                      1M-blocks  Used Available Use% Mounted on
/dev/mapper/vgtest-lv_var_mysql     5900M 2462M     3117M  45% /var/mysql
<span style="color:#75715e"># 查看各PV磁盘空间使用情况</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># pvscan</span>
  PV /dev/sdc5    VG vgtest          lvm2 <span style="color:#f92672">[</span>1020.00 MiB / <span style="color:#ae81ff">0</span>    free<span style="color:#f92672">]</span>
  PV /dev/sdc6    VG vgtest          lvm2 <span style="color:#f92672">[</span>&lt;2.00 GiB / <span style="color:#ae81ff">0</span>    free<span style="color:#f92672">]</span>
  PV /dev/sdc7    VG vgtest          lvm2 <span style="color:#f92672">[</span>&lt;2.00 GiB / &lt;2.00 GiB free<span style="color:#f92672">]</span>
  PV /dev/sdc8    VG vgtest          lvm2 <span style="color:#f92672">[</span>1020.00 MiB / 1020.00 MiB free<span style="color:#f92672">]</span>
  PV /dev/sdc9    VG vgtest          lvm2 <span style="color:#f92672">[</span>&lt;3.00 GiB / 8.00 MiB free<span style="color:#f92672">]</span>
  PV /dev/sdc10   VG vgtest          lvm2 <span style="color:#f92672">[</span>1020.00 MiB / 1020.00 MiB free<span style="color:#f92672">]</span>
</code></pre></td></tr></table>
</div>
</div><p>前期准备，转换xfs文件格式为ext4，并随便拷贝点数据到分区。可以看到lv分区总容量为5900M，也就是我们之前分配的5.9G。</p>
<p>顺便看下各pv的信息，可以发现<code>/dev/sdc5</code>这个PV共有1020M，且已全部被使用。</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># 先卸载，再校验ext4文件系统完整性。</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># umount /var/mysql</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># e2fsck -f /dev/vgtest/lv_var_mysql</span>
e2fsck 1.42.9 <span style="color:#f92672">(</span>28-Dec-2013<span style="color:#f92672">)</span>
Pass 1: Checking inodes, blocks, and sizes
Pass 2: Checking directory structure
Pass 3: Checking directory connectivity
Pass 4: Checking reference counts
Pass 5: Checking group summary information
/dev/vgtest/lv_var_mysql: 72557/392448 files <span style="color:#f92672">(</span>0.0% non-contiguous<span style="color:#f92672">)</span>, 687459/1567744 blocks
<span style="color:#75715e"># 重置文件系统大小</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># resize2fs /dev/vgtest/lv_var_mysql 4760M</span>
resize2fs 1.42.9 <span style="color:#f92672">(</span>28-Dec-2013<span style="color:#f92672">)</span>
Resizing the filesystem on /dev/vgtest/lv_var_mysql to <span style="color:#ae81ff">1218560</span> <span style="color:#f92672">(</span>4k<span style="color:#f92672">)</span> blocks.
The filesystem on /dev/vgtest/lv_var_mysql is now <span style="color:#ae81ff">1218560</span> blocks long.
<span style="color:#75715e"># 缩小lv分区，减少1020M</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># lvresize -L -1020M /dev/vgtest/lv_var_mysql</span>
  WARNING: Reducing active and open logical volume to 4.98 GiB.
  THIS MAY DESTROY YOUR DATA <span style="color:#f92672">(</span>filesystem etc.<span style="color:#f92672">)</span>
Do you really want to reduce vgtest/lv_var_mysql? <span style="color:#f92672">[</span>y/n<span style="color:#f92672">]</span>: y
  Size of logical volume vgtest/lv_var_mysql changed from 5.98 GiB <span style="color:#f92672">(</span><span style="color:#ae81ff">1531</span> extents<span style="color:#f92672">)</span> to 4.98 GiB <span style="color:#f92672">(</span><span style="color:#ae81ff">1276</span> extents<span style="color:#f92672">)</span>.
  Logical volume vgtest/lv_var_mysql successfully resized.
  
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># mount /dev/vgtest/lv_var_mysql /var/mysql/</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># df -BM /dev/vgtest/lv_var_mysql</span>
Filesystem                      1M-blocks  Used Available Use% Mounted on
/dev/mapper/vgtest-lv_var_mysql     4556M 2462M     1841M  58% /var/mysql
</code></pre></td></tr></table>
</div>
</div><p>要缩容，得先通知系统修改文件系统的大小。这里必须先用<code>e2fsck</code>检验文件系统完整性，才能用<code>resize2fs</code>重置大小，原本5900M，要最终把<code>/dev/sdc5</code>拿掉，需要减少1020M，所以重置后的容量大小不能超过<del>4780M</del> 4880M，这里用4760M。</p>
<p>如果只是缩小分区，不需要把硬盘、分区从lvm中挪出来另做他用，其实到这里把分区挂载回去就可以了，文件系统和lv分区本身都已经缩小了。</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># pvscan</span>
  PV /dev/sdc5    VG vgtest          lvm2 <span style="color:#f92672">[</span>1020.00 MiB / <span style="color:#ae81ff">0</span>    free<span style="color:#f92672">]</span>
  PV /dev/sdc6    VG vgtest          lvm2 <span style="color:#f92672">[</span>&lt;2.00 GiB / <span style="color:#ae81ff">0</span>    free<span style="color:#f92672">]</span>
  PV /dev/sdc7    VG vgtest          lvm2 <span style="color:#f92672">[</span>&lt;2.00 GiB / &lt;2.00 GiB free<span style="color:#f92672">]</span>
  PV /dev/sdc8    VG vgtest          lvm2 <span style="color:#f92672">[</span>1020.00 MiB / 1020.00 MiB free<span style="color:#f92672">]</span>
  PV /dev/sdc9    VG vgtest          lvm2 <span style="color:#f92672">[</span>&lt;3.00 GiB / 1.00 GiB free<span style="color:#f92672">]</span>
  PV /dev/sdc10   VG vgtest          lvm2 <span style="color:#f92672">[</span>1020.00 MiB / 1020.00 MiB free<span style="color:#f92672">]</span>
  
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># pvmove /dev/sdc5 /dev/sdc7</span>
  /dev/sdc5: Moved: 1.18%
  /dev/sdc5: Moved: 100.00%
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># vgreduce vgtest /dev/sdc5</span>
  Removed <span style="color:#d88200">&#34;/dev/sdc5&#34;</span> from volume group <span style="color:#d88200">&#34;vgtest&#34;</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># pvscan</span>
  PV /dev/sdc6    VG vgtest          lvm2 <span style="color:#f92672">[</span>&lt;2.00 GiB / <span style="color:#ae81ff">0</span>    free<span style="color:#f92672">]</span>
  PV /dev/sdc7    VG vgtest          lvm2 <span style="color:#f92672">[</span>&lt;2.00 GiB / 1.00 GiB free<span style="color:#f92672">]</span>
  PV /dev/sdc8    VG vgtest          lvm2 <span style="color:#f92672">[</span>1020.00 MiB / 1020.00 MiB free<span style="color:#f92672">]</span>
  PV /dev/sdc9    VG vgtest          lvm2 <span style="color:#f92672">[</span>&lt;3.00 GiB / 1.00 GiB free<span style="color:#f92672">]</span>
  PV /dev/sdc10   VG vgtest          lvm2 <span style="color:#f92672">[</span>1020.00 MiB / 1020.00 MiB free<span style="color:#f92672">]</span>

<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># pvremove /dev/sdc5</span>
  Labels on physical volume <span style="color:#d88200">&#34;/dev/sdc5&#34;</span> successfully wiped.
</code></pre></td></tr></table>
</div>
</div><p>虽然分区已经缩小了，但是实际数据其实还是存储在<code>/dev/sdc5</code>中的，所以我们需要先手动将数据迁移，然后再将<code>/dev/sdc5</code>从VG卷组中删除。</p>
<p>补充：刚才在缩小文件系统的时候，留了点空余量，所以此时文件系统本身会比lv分区稍微小一点的。我们也可以再次取消挂载后再运行一遍<code>e2fsck</code> <code>resize2fs</code></p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># umount /var/mysql</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># e2fsck -f /dev/vgtest/lv_var_mysql</span>

<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># resize2fs /dev/vgtest/lv_var_mysql</span>

<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># mount /dev/vgtest/lv_var_mysql /var/mysql/</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># df -BM /var/mysql/</span>
Filesystem                      1M-blocks  Used Available Use% Mounted on
/dev/mapper/vgtest-lv_var_mysql     4896M 2462M     2164M  54% /var/mysql
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># df -h /var/mysql/</span>
Filesystem                       Size  Used Avail Use% Mounted on
/dev/mapper/vgtest-lv_var_mysql  4.8G  2.5G  2.2G  54% /var/mysql
</code></pre></td></tr></table>
</div>
</div><h3 id="lvm精简置备">LVM精简置备</h3>
<p>所谓精简置备，大概可以理解为<strong>先预分配一个容量，但实际是用多少给多少，直到预分配容量用完</strong>。</p>
<p><em>比如在vmware esxi等虚拟化上，创建虚拟机的磁盘的时候，就有‘精简置备’、‘厚置备’、‘延迟厚置备’选项，如果选择<strong>精简置备</strong>模式创建虚拟机磁盘，磁盘容量需求1T的虚拟机刚创建的时候，可能实际使用量也才30G。</em></p>
<p><em>这样的效果就是，当前实际存储空间只有2T，也可以创建几十个磁盘空间需求500G的虚拟机，只要这些虚拟机的实际磁盘空间总使用量未达到2T就没事。</em></p>
<p><em>当然，最终存储容量还是要补上来的，要不然实际存储空间已经超了，但是对于每个虚拟机来说，实际使用空间并未达到上限，就会继续往磁盘写入数据，各虚拟机之间就会相互争抢存储空间，数据相互覆盖，导致虚拟机崩溃。</em></p>
<p>LVM的精简置备分区也是类似的效果，算是提高磁盘空间的利用效率，降低资产配置时的一次性资金需求？</p>
<p>其过程是先创建一个精简置备lv存储池，然后再基于该存储池创建一个精简置备lv，该lv的容量可以超过存储池。</p>
<p>下面的模拟测试中，先创建了存储池，容量是2G，然后基于该存储池创建了一个10G的精简置备lv。虽然有告警，但是成功了，其容量不仅超过了存储池的2G，甚至超过了vg卷组的9.98G。</p>
<p>但是要注意，这个时候lv的实际可用存储空间其实只有存储池的2G，要在已用容量超过2G之前扩容vg卷组，以及lv存储池，否则数据会出问题。至于lv存储池的扩容方法跟lv扩容一样。</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">87
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># 使用-T参数创建lv存储池。</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># lvcreate -L 2G -T vgtest/pool</span>
  Thin pool volume with chunk size 64.00 KiB can address at most 15.81 TiB of data.
  Logical volume <span style="color:#d88200">&#34;pool&#34;</span> created.
<span style="color:#75715e"># 使用-T指定关联的精简置备存储池，使用-V指定要创建的分区容量</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># lvcreate -V 10G -T vgtest/pool -n lv_thin1</span>
  WARNING: Sum of all thin volume sizes <span style="color:#f92672">(</span>10.00 GiB<span style="color:#f92672">)</span> exceeds the size of thin pool vgtest/pool and the size of whole volume group <span style="color:#f92672">(</span>8.98 GiB<span style="color:#f92672">)</span>.
  WARNING: You have not turned on protection against thin pools running out of space.
  WARNING: Set activation/thin_pool_autoextend_threshold below <span style="color:#ae81ff">100</span> to trigger automatic extension of thin pools before they get full.
  Logical volume <span style="color:#d88200">&#34;lv_thin1&#34;</span> created.
<span style="color:#75715e"># 挂载分区</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># mkfs.ext4 /dev/vgtest/lv_thin1</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># mkdir /var/thin1</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># mount /dev/vgtest/lv_thin1 /var/thin1/</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># df -Th /var/thin1/</span>
Filesystem                  Type  Size  Used Avail Use% Mounted on
/dev/mapper/vgtest-lv_thin1 ext4  9.8G   37M  9.2G   1% /var/thin1
<span style="color:#75715e"># 写入1.1G数据，然后比对分区使用率，虽然lv_thin1使用率才13.6%，但存储池pool使用率已达到28.42%。</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># dd if=/dev/zero of=/var/thin1/test.img bs=1M count=1100</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># df -h /var/thin1/</span>
Filesystem                   Size  Used Avail Use% Mounted on
/dev/mapper/vgtest-lv_thin1  9.8G  1.2G  8.1G  13% /var/thin1
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># lvs /dev/vgtest/lv_thin1</span>
  LV       VG     Attr       LSize  Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  lv_thin1 vgtest Vwi-aotz-- 10.00g pool        13.60                              
<span style="color:#75715e"># 此处存储池空间已变成3G，之前扩容了1G。</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># lvs /dev/vgtest/pool</span>
  LV   VG     Attr       LSize Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  pool vgtest twi-aotz-- 3.00g             45.35  28.42

<span style="color:#75715e"># 比较普通lv分区、lv存储池、精简置备lv分区的细节区别</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># lvdisplay</span>
  --- Logical volume ---
  LV Path                /dev/vgtest/lv_var_mysql
  LV Name                lv_var_mysql
  VG Name                vgtest
  LV UUID                bQRgl4-elDc-3t8f-Hewa-6Hjj-7cr1-fPZfRL
  LV Write Access        read/write
  LV Creation host, <span style="color:#111">time</span> localhost.localdomain, 2024-04-01 02:39:15 -0400
  LV Status              available
  <span style="color:#75715e"># open                 1</span>
  LV Size                4.98 GiB
  Current LE             <span style="color:#ae81ff">1276</span>
  Segments               <span style="color:#ae81ff">3</span>
  Allocation             inherit
  Read ahead sectors     auto
  - currently <span style="color:#111">set</span> to     <span style="color:#ae81ff">8192</span>
  Block device           253:2

  --- Logical volume ---
  LV Name                pool
  VG Name                vgtest
  LV UUID                Z6WXbJ-5jYQ-8JMQ-5IVs-6jXV-2GkE-bbZFcf
  LV Write Access        read/write <span style="color:#f92672">(</span>activated <span style="color:#111">read</span> only<span style="color:#f92672">)</span>
  LV Creation host, <span style="color:#111">time</span> localhost.localdomain, 2024-04-02 13:44:34 -0400
  LV Pool metadata       pool_tmeta
  LV Pool data           pool_tdata
  LV Status              available
  <span style="color:#75715e"># open                 2</span>
  LV Size                3.00 GiB
  Allocated pool data    45.35%		<span style="color:#75715e"># 已使用存储池空间百分比</span>
  Allocated metadata     28.42%		<span style="color:#75715e"># 已存入元数据的空间占用百分比</span>
  Current LE             <span style="color:#ae81ff">768</span>
  Segments               <span style="color:#ae81ff">1</span>
  Allocation             inherit
  Read ahead sectors     auto
  - currently <span style="color:#111">set</span> to     <span style="color:#ae81ff">8192</span>
  Block device           253:5

  --- Logical volume ---
  LV Path                /dev/vgtest/lv_thin1
  LV Name                lv_thin1
  VG Name                vgtest
  LV UUID                60mkLL-4KIT-znG2-GBIb-iQhD-A03j-ci5tfF
  LV Write Access        read/write
  LV Creation host, <span style="color:#111">time</span> localhost.localdomain, 2024-04-02 13:46:09 -0400
  LV Pool name           pool		<span style="color:#75715e"># 对应存储池名称</span>
  LV Status              available
  <span style="color:#75715e"># open                 1</span>
  LV Size                10.00 GiB
  Mapped size            13.60%		<span style="color:#75715e"># 已分配空间与最大空间百分比</span>
  Current LE             <span style="color:#ae81ff">2560</span>
  Segments               <span style="color:#ae81ff">1</span>
  Allocation             inherit
  Read ahead sectors     auto
  - currently <span style="color:#111">set</span> to     <span style="color:#ae81ff">8192</span>
  Block device           253:7
</code></pre></td></tr></table>
</div>
</div><h3 id="lvm快照">LVM快照</h3>
<p>lvm还可以创建快照lv，其功能可以理解为对另一逻辑卷（原lv）中的数据拍个照，保存其在当前时间下的数据存储状态，等于设置了一个还原点位，后续再有数据写入或者修改什么的，这些变化差异会被记录下来，有需要的时候，可以还原回之前的数据状态。</p>
<p>要创建快照lv，就是给<code>lvcreate</code>命令添加<code>-s</code>参数，并指明想要快照的原lv：</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># 创建个测试文件，并确认文件内容。</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># head -5 /var/log/messages &gt;&gt; /var/mysql/usr/test.txt</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># cat /var/mysql/usr/test.txt</span>
Mar <span style="color:#ae81ff">31</span> 05:41:01 localhost rsyslogd: <span style="color:#f92672">[</span>origin <span style="color:#111">software</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;rsyslogd&#34;</span> <span style="color:#111">swVersion</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;8.24.0-57.el7_9.3&#34;</span> x-pid<span style="color:#f92672">=</span><span style="color:#d88200">&#34;978&#34;</span> x-info<span style="color:#f92672">=</span><span style="color:#d88200">&#34;http://www.rsyslog.com&#34;</span><span style="color:#f92672">]</span> rsyslogd was HUPed
Mar <span style="color:#ae81ff">31</span> 05:41:02 localhost systemd: Removed slice User Slice of root.
Mar <span style="color:#ae81ff">31</span> 06:01:01 localhost systemd: Created slice User Slice of root.
Mar <span style="color:#ae81ff">31</span> 06:01:01 localhost systemd: Started Session <span style="color:#ae81ff">4</span> of user root.
Mar <span style="color:#ae81ff">31</span> 06:01:01 localhost systemd: Removed slice User Slice of root.
<span style="color:#75715e"># 使用-s参数创建快照lv，快照名称为snap，对应的想要快照的原始lv为lv_var_mysql</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># lvcreate -s -L 2G -n snap /dev/vgtest/lv_var_mysql</span>
  Logical volume <span style="color:#d88200">&#34;snap&#34;</span> created.
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># lvdisplay /dev/vgtest/snap</span>
  --- Logical volume ---
  <span style="color:#75715e"># ...其他省略...</span>
  <span style="color:#75715e"># open                 0</span>
  LV Size                4.98 GiB	<span style="color:#75715e"># 原始lv大小</span>
  Current LE             <span style="color:#ae81ff">1276</span>
  COW-table size         2.00 GiB	<span style="color:#75715e"># 该快照lv本身的大小</span>
  COW-table LE           <span style="color:#ae81ff">512</span>
  Allocated to snapshot  0.01%		<span style="color:#75715e"># 该快照lv已用容量百分比</span>
  Snapshot chunk size    4.00 KiB
  <span style="color:#75715e"># ...其他省略...</span>
<span style="color:#75715e"># 挂载快照lv，虽然刚创建的快照lv的容量只有2G，且未对其做任何修改删除数据等操作，但是此处两者看起来是一样一样的。</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># mkdir /var/snap</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># mount /dev/vgtest/snap /var/snap/</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># df -Th /var/mysql/ /var/snap/</span>
Filesystem                      Type  Size  Used Avail Use% Mounted on
/dev/mapper/vgtest-lv_var_mysql ext4  4.8G  2.5G  2.2G  54% /var/mysql
/dev/mapper/vgtest-snap         ext4  4.8G  2.5G  2.2G  54% /var/snap
<span style="color:#75715e"># 修改/var/mysql中的数据</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># rm -rf /var/mysql/usr/l*</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># tail -n 5 /var/log/messages &gt; /var/mysql/usr/test.txt</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># dd if=/dev/zero of=/var/mysql/a.img bs=1M count=500</span>
<span style="color:#75715e"># 两者出现了差异，/var/mysql更新了，但/var/snap还是老样子</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># df -Th /var/mysql/ /var/snap/</span>
Filesystem                      Type  Size  Used Avail Use% Mounted on
/dev/mapper/vgtest-lv_var_mysql ext4  4.8G  1.3G  3.3G  28% /var/mysql
/dev/mapper/vgtest-snap         ext4  4.8G  2.5G  2.2G  54% /var/snap
<span style="color:#75715e"># test.txt文件中的内容也是，一个更新了，一个还是老的</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># cat /var/mysql/usr/test.txt</span>
Apr  <span style="color:#ae81ff">6</span> 15:01:01 localhost systemd: Created slice User Slice of root.
Apr  <span style="color:#ae81ff">6</span> 15:01:01 localhost systemd: Started Session <span style="color:#ae81ff">144</span> of user root.
Apr  <span style="color:#ae81ff">6</span> 15:01:01 localhost systemd: Removed slice User Slice of root.
Apr  <span style="color:#ae81ff">6</span> 15:01:43 localhost kernel: EXT4-fs <span style="color:#f92672">(</span>dm-5<span style="color:#f92672">)</span>: Unrecognized mount option <span style="color:#d88200">&#34;nouuid&#34;</span> or missing value
Apr  <span style="color:#ae81ff">6</span> 15:13:33 localhost kernel: EXT4-fs <span style="color:#f92672">(</span>dm-5<span style="color:#f92672">)</span>: mounted filesystem with ordered data mode. Opts: <span style="color:#f92672">(</span>null<span style="color:#f92672">)</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># cat /var/snap/usr/test.txt</span>
Mar <span style="color:#ae81ff">31</span> 05:41:01 localhost rsyslogd: <span style="color:#f92672">[</span>origin <span style="color:#111">software</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;rsyslogd&#34;</span> <span style="color:#111">swVersion</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;8.24.0-57.el7_9.3&#34;</span> x-pid<span style="color:#f92672">=</span><span style="color:#d88200">&#34;978&#34;</span> x-info<span style="color:#f92672">=</span><span style="color:#d88200">&#34;http://www.rsyslog.com&#34;</span><span style="color:#f92672">]</span> rsyslogd was HUPed
Mar <span style="color:#ae81ff">31</span> 05:41:02 localhost systemd: Removed slice User Slice of root.
Mar <span style="color:#ae81ff">31</span> 06:01:01 localhost systemd: Created slice User Slice of root.
Mar <span style="color:#ae81ff">31</span> 06:01:01 localhost systemd: Started Session <span style="color:#ae81ff">4</span> of user root.
Mar <span style="color:#ae81ff">31</span> 06:01:01 localhost systemd: Removed slice User Slice of root.
# 
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># lvdisplay /dev/vgtest/snap</span>
  --- Logical volume ---
  <span style="color:#75715e"># ...其他省略...</span>
  <span style="color:#75715e"># open                 1</span>
  LV Size                4.98 GiB
  Current LE             <span style="color:#ae81ff">1276</span>
  COW-table size         2.00 GiB
  COW-table LE           <span style="color:#ae81ff">512</span>
  Allocated to snapshot  25.18%		<span style="color:#75715e"># 该快照lv已用容量百分比更新了，根据总容量2G来计算，即500M</span>
  Snapshot chunk size    4.00 KiB
  <span style="color:#75715e"># ...其他省略...</span>

</code></pre></td></tr></table>
</div>
</div><p><strong>个人思考</strong>：当我执行<code>rm -rf /var/mysql/usr/l*</code>删除原lv中的数据（这部分数据拷贝自/usr），通过<code>lvdisplay</code>查看快照lv，<code>Allocated to snapshot</code>这个快照lv的已用容量百分比基本没变，应该是在原lv中删除了指向这些数据的指针。但是当我使用<code>dd</code>命令在原lv中新增了一个500M的垃圾文件时，快照lv中<code>Allocated to snapshot</code>的使用量也新增了25%（虽然快照lv中找不到该垃圾文件），即便原lv中再次删除该垃圾文件，快照lv中的使用率也不会降低，有一种新增的数据在快照lv中也复制了一份的错觉。快照lv不是记录原lv之前的数据情况吗，为什么新增的也做了记录？此处不是很理解。</p>
<p>智谱清言对相关lvm问题的回答：<a href="https://chatglm.cn/share/Fo7Ox">创建快照lv之后，再对原lv中的数据进行新增、删除等操作&hellip; </a>。</p>
<p>要还原快照lv，使用<code>lvconvert</code>命令：</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># 开始还原快照操作</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># ls /var/mysql/</span>
a.img  lost+found  usr
<span style="color:#75715e"># 首先确保原lv和快照lv都处于卸载状态</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># umount /var/mysql</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># umount /var/snap</span>
<span style="color:#75715e"># 还原快照lv的命令</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># lvconvert --merge /dev/vgtest/snap</span>
  Merging of volume vgtest/snap started.
  vgtest/lv_var_mysql: Merged: 53.63%
  vgtest/lv_var_mysql: Merged: 100.00%
<span style="color:#75715e"># 还原成功后，快照lv被自动删除了</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># lvscan</span>
  ACTIVE            <span style="color:#d88200">&#39;/dev/vgtest/lv_var_mysql&#39;</span> <span style="color:#f92672">[</span>4.98 GiB<span style="color:#f92672">]</span> inherit
<span style="color:#75715e"># 重新挂载原lv</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># mount /dev/vgtest/lv_var_mysql /var/mysql/</span>
<span style="color:#75715e"># 存储容量使用率已恢复原来的状态</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># df -Th /var/mysql/</span>
Filesystem                      Type  Size  Used Avail Use% Mounted on
/dev/mapper/vgtest-lv_var_mysql ext4  4.8G  2.5G  2.2G  54% /var/mysql
<span style="color:#75715e"># dd命令生成的文件a.img没有了</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># ls /var/mysql/</span>
lost+found  usr
<span style="color:#75715e"># usr目录下 l 开头的被删除的文件目录回来了</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># ls /var/mysql/usr/</span>
bin  games    lib    libexec  sbin   src       tmp
etc  include  lib64  <span style="color:#111">local</span>    share  test.txt
<span style="color:#75715e"># test.txt文件的内容也恢复到之前的状态了</span>
<span style="color:#f92672">[</span>root@localhost xy<span style="color:#f92672">]</span><span style="color:#75715e"># cat /var/mysql/usr/test.txt</span>
Mar <span style="color:#ae81ff">31</span> 05:41:01 localhost rsyslogd: <span style="color:#f92672">[</span>origin <span style="color:#111">software</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;rsyslogd&#34;</span> <span style="color:#111">swVersion</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;8.24.0-57.el7_9.3&#34;</span> x-pid<span style="color:#f92672">=</span><span style="color:#d88200">&#34;978&#34;</span> x-info<span style="color:#f92672">=</span><span style="color:#d88200">&#34;http://www.rsyslog.com&#34;</span><span style="color:#f92672">]</span> rsyslogd was HUPed
Mar <span style="color:#ae81ff">31</span> 05:41:02 localhost systemd: Removed slice User Slice of root.
Mar <span style="color:#ae81ff">31</span> 06:01:01 localhost systemd: Created slice User Slice of root.
Mar <span style="color:#ae81ff">31</span> 06:01:01 localhost systemd: Started Session <span style="color:#ae81ff">4</span> of user root.
Mar <span style="color:#ae81ff">31</span> 06:01:01 localhost systemd: Removed slice User Slice of root.
</code></pre></td></tr></table>
</div>
</div><p><strong>注意</strong>：还原操作是不可逆的，原lv创建快照后的所有的修改都会被删除。所以，有必要的话，在开始还原前，先对原lv做个数据备份；或者只需要还原部分确定的数据的话，可以挂载快照lv，手动复制相关文件到原lv。</p>
<p>当然，最好的选择是，对于需要用到快照lv的文件系统，创建、删除快照lv勤快点。遇到要执行不确定的操作，先提前创建快照；经过一段时间，确定相关操作没问题，已经不需要还原了，就及时删除快照。毕竟随着时间的积累，原lv中的数据的大量更改，快照也是挺消耗存储空间的。</p>
<p><strong>补充</strong>：lvm快照的经典用法 →点击查看智谱清言的回答<a href="https://chatglm.cn/share/Fo7xu">https://chatglm.cn/share/Fo7xu</a>。</p>
        </div>

        
<div class="post-archive">
    <ul class="post-copyright">
        <li><strong>原文作者：</strong><a rel="author" href="https://xy-ylr.github.io">四十荀</a></li>
        <li style="word-break:break-all"><strong>原文链接：</strong><a href="https://xy-ylr.github.io/it/linux_lvm/">https://xy-ylr.github.io/it/linux_lvm/</a></li>
        <li><strong>版权声明：</strong>本作品采用<a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可，非商业转载请注明出处（作者，原文链接），商业转载请联系作者获得授权。</li>
    </ul>
</div>
<br/>



        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/it/linux_install_zabbix/">Linux操作系统上安装Zabbix运维工具并基础配置</a></li>
        
        <li><a href="/it/linux_ssh/">Linux禁用root远程登录</a></li>
        
        <li><a href="/it/linux_commands/">Linux常用命令笔记</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='/tags/linux'>linux</a></li>
                
                <li><a href='/tags/lvm'>lvm</a></li>
                
                <li><a href='/tags/%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86'>磁盘管理</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "xy-ylr/blog-comments"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
    
    

</div>

                    <footer id="footer">
    <div>
        &copy; 2024 <a href="https://xy-ylr.github.io">四十荀的博客 By 四十荀</a>
        
        | <a rel="nofollow" target="_blank" href="http://beian.miit.gov.cn/">浙ICP备2023002264号-1</a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://www.flysnow.org/" target="_black"><span class="badge-subject">Design by</span><span class="badge-value bg-brightgreen">飞雪无情</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
</footer>


    
    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script><script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>
    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://xy-ylr.github.io/search' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://xy-ylr.github.io">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://xy-ylr.github.io/it/kali_configure_openvas/" title="Kali2024.1安装配置openvas(gvm)漏洞扫描软件">Kali2024.1安装配置openvas(gvm)漏洞扫描软件</a>
    </li>
    
    <li>
        <a href="https://xy-ylr.github.io/it/linux_iso2local_yum/" title="Linux使用iso镜像制作本地源">Linux使用iso镜像制作本地源</a>
    </li>
    
    <li>
        <a href="https://xy-ylr.github.io/it/vmware_patches_updates/" title="Vmware更新补丁方法">Vmware更新补丁方法</a>
    </li>
    
    <li>
        <a href="https://xy-ylr.github.io/it/zabbix_snmp_trap/" title="Zabbix配置snmp trap接收主动告警">Zabbix配置snmp trap接收主动告警</a>
    </li>
    
    <li>
        <a href="https://xy-ylr.github.io/it/vlmcsd_kms/" title="利用VLMCSD部署本地KMS服务器">利用VLMCSD部署本地KMS服务器</a>
    </li>
    
    <li>
        <a href="https://xy-ylr.github.io/it/snmp/" title="SNMP基础">SNMP基础</a>
    </li>
    
    <li>
        <a href="https://xy-ylr.github.io/it/huawei_css/" title="华为交换机STACK堆叠与CSS集群配置">华为交换机STACK堆叠与CSS集群配置</a>
    </li>
    
    <li>
        <a href="https://xy-ylr.github.io/it/h3c_complex_nat/" title="H3c防火墙双向地址转换配置">H3c防火墙双向地址转换配置</a>
    </li>
    
    <li>
        <a href="https://xy-ylr.github.io/it/h3c_snat/" title="H3c防火墙源地址转换配置">H3c防火墙源地址转换配置</a>
    </li>
    
    <li>
        <a href="https://xy-ylr.github.io/it/h3c_network_nat/" title="H3C防火墙NAT配置">H3C防火墙NAT配置</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href='/categories/'>分类</a></h3>
<ul class="widget-list">
    
    <li><a href="https://xy-ylr.github.io/categories/Windows/">Windows (1)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/debian/">debian (1)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/git/">git (4)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/linux/">linux (9)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/office%E5%8A%9E%E5%85%AC/">office办公 (1)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/snmp/">snmp (1)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/vmware/">vmware (1)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/zabbix/">zabbix (2)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/%E5%81%A5%E8%BA%AB/">健身 (1)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/%E5%86%9C%E4%B8%9A/">农业 (1)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/%E7%90%86%E8%B4%A2/">理财 (1)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/%E7%BC%96%E8%BE%91/">编辑 (3)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/%E7%BD%91%E7%BB%9C/">网络 (11)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/%E8%BF%90%E7%BB%B4/">运维 (2)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/tags/'>标签</a></h3>
<div class="tagcloud">
    
    <a href="https://xy-ylr.github.io/tags/DHCP/">DHCP</a>
    
    <a href="https://xy-ylr.github.io/tags/alias/">alias</a>
    
    <a href="https://xy-ylr.github.io/tags/apt/">apt</a>
    
    <a href="https://xy-ylr.github.io/tags/bash-shell/">bash shell</a>
    
    <a href="https://xy-ylr.github.io/tags/css%E9%9B%86%E7%BE%A4/">css集群</a>
    
    <a href="https://xy-ylr.github.io/tags/debian/">debian</a>
    
    <a href="https://xy-ylr.github.io/tags/dnf/">dnf</a>
    
    <a href="https://xy-ylr.github.io/tags/excel/">excel</a>
    
    <a href="https://xy-ylr.github.io/tags/firewalld/">firewalld</a>
    
    <a href="https://xy-ylr.github.io/tags/git/">git</a>
    
    <a href="https://xy-ylr.github.io/tags/github/">github</a>
    
    <a href="https://xy-ylr.github.io/tags/h3c/">h3c</a>
    
    <a href="https://xy-ylr.github.io/tags/h3c%E9%98%B2%E7%81%AB%E5%A2%99/">h3c防火墙</a>
    
    <a href="https://xy-ylr.github.io/tags/hugo/">hugo</a>
    
    <a href="https://xy-ylr.github.io/tags/irf/">irf</a>
    
    <a href="https://xy-ylr.github.io/tags/kali/">kali</a>
    
    <a href="https://xy-ylr.github.io/tags/kms%E6%BF%80%E6%B4%BB/">kms激活</a>
    
    <a href="https://xy-ylr.github.io/tags/linux/">linux</a>
    
    <a href="https://xy-ylr.github.io/tags/lvm/">lvm</a>
    
    <a href="https://xy-ylr.github.io/tags/nat/">nat</a>
    
    <a href="https://xy-ylr.github.io/tags/nat%E9%85%8D%E7%BD%AE/">nat配置</a>
    
    <a href="https://xy-ylr.github.io/tags/network/">network</a>
    
    <a href="https://xy-ylr.github.io/tags/openvasgvm/">openvas(gvm)</a>
    
    <a href="https://xy-ylr.github.io/tags/patch-update/">patch update</a>
    
    <a href="https://xy-ylr.github.io/tags/rime/">rime</a>
    
    <a href="https://xy-ylr.github.io/tags/selinux/">selinux</a>
    
    <a href="https://xy-ylr.github.io/tags/snmp/">snmp</a>
    
    <a href="https://xy-ylr.github.io/tags/snmp-trap/">snmp trap</a>
    
    <a href="https://xy-ylr.github.io/tags/ssh/">ssh</a>
    
    <a href="https://xy-ylr.github.io/tags/sudo/">sudo</a>
    
    <a href="https://xy-ylr.github.io/tags/typora/">typora</a>
    
    <a href="https://xy-ylr.github.io/tags/vmware/">vmware</a>
    
    <a href="https://xy-ylr.github.io/tags/windows%E6%BF%80%E6%B4%BB/">windows激活</a>
    
    <a href="https://xy-ylr.github.io/tags/yum/">yum</a>
    
    <a href="https://xy-ylr.github.io/tags/zabbix/">zabbix</a>
    
    <a href="https://xy-ylr.github.io/tags/%E5%81%A5%E8%BA%AB/">健身</a>
    
    <a href="https://xy-ylr.github.io/tags/%E5%86%9C%E4%B8%9A/">农业</a>
    
    <a href="https://xy-ylr.github.io/tags/%E5%88%86%E5%8C%BA/">分区</a>
    
    <a href="https://xy-ylr.github.io/tags/%E5%8D%8E%E4%B8%BA/">华为</a>
    
    <a href="https://xy-ylr.github.io/tags/%E6%8C%82%E8%BD%BD/">挂载</a>
    
    <a href="https://xy-ylr.github.io/tags/%E6%A0%BC%E5%BC%8F%E5%8C%96/">格式化</a>
    
    <a href="https://xy-ylr.github.io/tags/%E6%BC%8F%E6%89%AB/">漏扫</a>
    
    <a href="https://xy-ylr.github.io/tags/%E7%82%92%E8%82%A1/">炒股</a>
    
    <a href="https://xy-ylr.github.io/tags/%E7%90%86%E8%B4%A2/">理财</a>
    
    <a href="https://xy-ylr.github.io/tags/%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86/">磁盘管理</a>
    
    <a href="https://xy-ylr.github.io/tags/%E7%BD%91%E7%BB%9C/">网络</a>
    
    <a href="https://xy-ylr.github.io/tags/%E7%BD%91%E7%BB%9C-MSTP/">网络, MSTP</a>
    
    <a href="https://xy-ylr.github.io/tags/%E7%BD%91%E7%BB%9C%E4%B8%A2%E5%8C%85/">网络丢包</a>
    
    <a href="https://xy-ylr.github.io/tags/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%B8%88/">网络工程师</a>
    
    <a href="https://xy-ylr.github.io/tags/%E7%BD%91%E7%BB%9C%E6%8E%92%E9%9A%9C/">网络排障</a>
    
    <a href="https://xy-ylr.github.io/tags/%E7%BD%91%E7%BB%9C%E7%8E%AF%E8%B7%AF/">网络环路</a>
    
    <a href="https://xy-ylr.github.io/tags/%E8%BF%90%E7%BB%B4/">运维</a>
    
</div>
    </section>

    
<section class="widget">
    <h3 class="widget-title">友情链接</h3>
    <ul class="widget-list">
        
        <li>
            <a target="_blank" href="https://www.flysnow.org/" title="飞雪无情的博客">飞雪无情的博客</a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://xy-ylr.github.io/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>

</html>