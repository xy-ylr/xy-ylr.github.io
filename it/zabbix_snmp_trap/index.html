<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    

    <title>Zabbix配置snmp trap接收主动告警 | 四十荀的博客</title>
    <meta property="og:title" content="Zabbix配置snmp trap接收主动告警 - 四十荀的博客">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2024-03-07T10:06:19&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2024-03-07T10:06:19&#43;08:00'>
        
    <meta name="Keywords" content="[snmptrap, zabbix配置snmptrap]">
    <meta name="description" content="snmptrap, zabbix配置snmptrap">
        
    <meta name="author" content="四十荀">
    <meta property="og:url" content="https://xy-ylr.github.io/it/zabbix_snmp_trap/">
    <link rel="shortcut icon" href='/favicon.ico'  type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
        <link href="https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" rel="stylesheet">
    
    
    
    
</head>

<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://xy-ylr.github.io">
                        四十荀的博客
                    </a>
                
                <p class="description">运维工程师, 未来新农人, 间歇性运动</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="" href="https://xy-ylr.github.io">首页</a>
                    
                    <a  href="https://xy-ylr.github.io/it/" title="计算机">计算机</a>
                    
                    <a  href="https://xy-ylr.github.io/licai/" title="理财">理财</a>
                    
                    <a  href="https://xy-ylr.github.io/nongye/" title="农业">农业</a>
                    
                    <a  href="https://xy-ylr.github.io/yundong/" title="健身">健身</a>
                    
                    <a  href="https://xy-ylr.github.io/archives/" title="归档">归档</a>
                    
                    <a  href="https://xy-ylr.github.io/about/" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    <style type="text/css">
    .post-toc {
        position: fixed;
        width: 200px;
        margin-left: -230px;
        padding: 5px 10px;
        font-family: Athelas, STHeiti, Microsoft Yahei, serif;
        font-size: 12px;
        border: 1px solid rgba(0, 0, 0, .07);
        border-radius: 5px;
        background-color: rgba(255, 255, 255, 0.98);
        background-clip: padding-box;
        -webkit-box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        box-shadow: 1px 1px 2px rgba(0, 0, 0, .125);
        word-wrap: break-word;
         
         
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        z-index: 999;
        cursor: pointer;
        max-height: 70%;
        overflow-y: auto;
        overflow-x: hidden;
    }

    .post-toc .post-toc-title {
        width: 100%;
        margin: 0 auto;
        font-size: 20px;
        font-weight: 400;
        text-transform: uppercase;
        text-align: center;
    }

    .post-toc .post-toc-content {
        font-size: 15px;
    }

    .post-toc .post-toc-content>nav>ul {
        margin: 10px 0;
    }

    .post-toc .post-toc-content ul {
        padding-left: 20px;
        list-style: square;
        margin: 0.5em;
        line-height: 1.8em;
    }

    .post-toc .post-toc-content ul ul {
        padding-left: 15px;
         
         
    }

    @media print,
    screen and (max-width:1057px) {
        .post-toc {
            display: none;
        }
    }
</style>
<div class="post-toc" style="position: absolute; top: 188px;">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#相关软件包安装">相关软件包安装</a>
      <ul>
        <li><a href="#手动安装snmptt">手动安装snmptt</a></li>
      </ul>
    </li>
    <li><a href="#配置">配置</a>
      <ul>
        <li><a href="#配置snmptrapd">配置snmptrapd</a></li>
        <li><a href="#配置snmptt">配置snmptt</a></li>
        <li><a href="#配置zabbix">配置zabbix</a></li>
      </ul>
    </li>
    <li><a href="#验证配置">验证配置</a></li>
    <li><a href="#关于snmptt安全设置">关于snmptt安全设置</a></li>
    <li><a href="#参考">参考</a></li>
  </ul>
</nav>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function () {
        var postToc = $(".post-toc");
        if (postToc.length) {
            var leftPos = $("#main").offset().left;
            if (leftPos < 220) {
                postToc.css({ "width": leftPos - 10, "margin-left": (0 - leftPos) })
            }

            var t = postToc.offset().top - 20,
                a = {
                    start: {
                        position: "absolute",
                        top: t
                    },
                    process: {
                        position: "fixed",
                        top: 20
                    },
                };
            $(window).scroll(function () {
                var e = $(window).scrollTop();
                e < t ? postToc.css(a.start) : postToc.css(a.process)
            })
        }

        if ($("#TableOfContents").children().length < 1) {
            $(".post-toc").remove();
        }
    })
</script>
    <article class="post">
        <header>
            <h1 class="post-title">Zabbix配置snmp trap接收主动告警</h1>
        </header>
        <date class="post-meta meta-date">
            2024年3月7日
        </date>
        
        <div class="post-meta">
            <span>|</span>
            
            <span class="meta-category"><a href='/categories/zabbix'>zabbix</a></span>
            
            <span class="meta-category"><a href='/categories/%E8%BF%90%E7%BB%B4'>运维</a></span>
            
            <span class="meta-category"><a href='/categories/linux'>linux</a></span>
            
        </div>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-meta">
            <span>|</span>
            <span> 共约6144字 </span>
            <span> 预计阅读时间13分钟</span>
        </div>
        
        
        <div class="clear" style="display: none">
            <div class="toc-article">
                <div class="toc-title">文章目录</div>
            </div>
        </div>
        
        
        

    
    
    

    
    




        <div class="post-content">
            <p>zabbix可以通过snmp主动获取被监控主机的相关信息，但是也由于其主动性，被监控主机突发的故障等行为，可能就无法及时获知。而如果频繁的主动发起snmpget获取主机信息，对于zabbix服务器、整体网络资源等，都会产生额外的资源消耗。所以可以配置snmp trap自动接收被管理主机主动发起的trap告警。</p>
<p><strong>系统环境</strong>：<u>本文系统环境基于官方zabbix appliance 6.0，对应的操作系统AlmaLinux 8</u>。</p>
<p>在 Zabbix 中接收 SNMP trap要与 <strong>snmptrapd</strong> 一起使用，其工作流程大致如下：</p>
<ol>
<li><code>snmptrapd </code>收到trap</li>
<li><code>snmptrapd</code> 将陷阱传递给接收器脚本（Bash、Perl）或 SNMPTT</li>
<li>SNMPTT或Perl trap接收器解析，格式化并将trap写入文件</li>
<li>Zabbix SNMP trap读取并解析trap文件</li>
<li>对于每个trap，Zabbix发现主机接口与接收的trap地址匹配的所有“SNMP trap”监控项。请注意，在匹配期间只使用主机接口中选定的“IP”或“DNS”。</li>
<li>对于每个找到的监控项，将trap与“snmptrap[regexp]”中的regexp进行比较。 trap设置为all匹配项的值。如果没有找到匹配的监控项，并且有一个“snmptrap.fallback”监控项，则将trap设置为该值。</li>
<li>如果trap未设置为任何监控项的值，Zabbix默认记录不匹配的trap。（这由管理 - &gt;常规 - &gt;其它中的“记录不匹配的SNMP trap（Log unmatched SNMP traps）”配置。）</li>
</ol>
<h2 id="相关软件包安装">相关软件包安装</h2>
<p>从工作流程可以看出，主要涉及接收器snmptrapd服务、接收器的外部解释器snmptt和perl（zabbix官方说法，测试环境可以用bash脚本，比较简单，但是生产环境，推荐用perl+snmptt，性能更好）。</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># snmptrapd在其中net-snmp包中；如果需要在终端使用snmpwalk等命令的话需要安装net-snmp-utils。</span>
<span style="color:#f92672">[</span>root@appliance ~<span style="color:#f92672">]</span><span style="color:#75715e"># dnf install -y net-snmp net-snmp-utils</span>
<span style="color:#75715e"># 安装snmp trap相关的安装包：snmptt、perl接收器脚本</span>
<span style="color:#f92672">[</span>root@appliance ~<span style="color:#f92672">]</span><span style="color:#75715e"># dnf install -y net-snmp-perl</span>
<span style="color:#f92672">[</span>root@appliance ~<span style="color:#f92672">]</span><span style="color:#75715e"># dnf install -y epel</span>
<span style="color:#f92672">[</span>root@appliance ~<span style="color:#f92672">]</span><span style="color:#75715e"># dnf install -y snmptt</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>注意</strong>：按第三方教程，snmptt包在epel扩展源中，但是估计被移除了，本人测试的zabbix appliance为6.x版，对应almalinux8，安装epel后还是无法找到snmptt包。根据zabbix官方文档说法net-snmp-perl也可能被移除。如果相关软件包被移除，则可能需要使用源码安装。</p>
<p><strong>注意2</strong>：zabbix appliance安装，可能还需要安装unzip、wget等软件包。</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@appliance ~<span style="color:#f92672">]</span><span style="color:#75715e"># dnf install -y wget unzip</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="手动安装snmptt">手动安装snmptt</h3>
<p>snmptt包可以从<a href="https://sourceforge.net/projects/snmptt/files/snmptt/">snmptt官方下载</a>或者<a href="https://github.com/AlexB7/snmptt">从github下载</a>。</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@appliance ~<span style="color:#f92672">]</span><span style="color:#75715e"># curl -o snmptt.zip https://codeload.github.com/AlexB7/snmptt/zip/refs/tags/snmptt_1-5</span>
<span style="color:#f92672">[</span>root@appliance ~<span style="color:#f92672">]</span><span style="color:#75715e"># unzip snmptt.zip</span>
<span style="color:#f92672">[</span>root@appliance ~<span style="color:#f92672">]</span><span style="color:#75715e"># ls -l</span>
-rw-r--r--  <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">794691</span> Mar <span style="color:#ae81ff">11</span> 00:55 snmptt_1-5.zip
drwxr-xr-x  <span style="color:#ae81ff">4</span> root root     <span style="color:#ae81ff">51</span> Aug <span style="color:#ae81ff">18</span>  <span style="color:#ae81ff">2022</span> snmptt-snmptt_1-5
<span style="color:#f92672">[</span>root@appliance ~<span style="color:#f92672">]</span><span style="color:#75715e"># ll snmptt-snmptt_1-5/</span>
total <span style="color:#ae81ff">12</span>
drwxr-xr-x <span style="color:#ae81ff">4</span> root root <span style="color:#ae81ff">4096</span> Aug <span style="color:#ae81ff">18</span>  <span style="color:#ae81ff">2022</span> htdocs
-rw-r--r-- <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">3739</span> Aug <span style="color:#ae81ff">18</span>  <span style="color:#ae81ff">2022</span> README.md
drwxr-xr-x <span style="color:#ae81ff">6</span> root root <span style="color:#ae81ff">4096</span> Aug <span style="color:#ae81ff">18</span>  <span style="color:#ae81ff">2022</span> snmptt
<span style="color:#f92672">[</span>root@appliance ~<span style="color:#f92672">]</span><span style="color:#75715e"># cd snmptt-snmptt_1-5/snmptt</span>
<span style="color:#75715e"># 注意是复制snmptt目录下的snmptt文件</span>
<span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># cp snmptt /usr/sbin/</span>
<span style="color:#75715e"># 确保snmptt具备可执行权限。</span>
<span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># chmod +x /usr/sbin/snmptt</span>
<span style="color:#75715e"># 创建snmptt用户，用于运行snmptt进程。</span>
<span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># adduser -r snmptt</span>
<span style="color:#75715e"># 创建/etc/snmptt目录</span>
<span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># mkdir /etc/snmptt</span>
<span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># chown -R snmptt.snmptt /etc/snmptt</span>
<span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># chmod 750 /etc/snmptt</span>
<span style="color:#75715e"># 配置文件snmptt.ini复制包里自带的</span>
<span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># cp snmptt.ini /etc/snmptt/</span>
<span style="color:#75715e"># 配置文件snmptt.conf新建空文件</span>
<span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># touch /etc/snmptt/snmptt.conf</span>
<span style="color:#75715e"># 继续创建相关目录 /var/log/snmptt、/var/spool/snmptt/</span>
<span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># mkdir /var/log/snmptt</span>
<span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># chown -R snmptt.snmptt /var/log/snmptt</span>
<span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># chmod -R 750 /var/log/snmptt</span>
<span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># mkdir /var/spool/snmptt/</span>
<span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># chown -R snmptt.snmptt /var/spool/snmptt</span>
<span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># chmod -R 750 /var/spool/snmptt</span>
<span style="color:#75715e"># 配置开机启动并运行snmptt</span>
<span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># cp snmptt.service /usr/lib/systemd/system/snmptt.service</span>
<span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># systemctl enable snmptt.service</span>
<span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># systemctl start snmptt.service</span>
Job <span style="color:#00a8c8">for</span> snmptt.service failed because the control process exited with error code.
See <span style="color:#d88200">&#34;systemctl status snmptt.service&#34;</span> and <span style="color:#d88200">&#34;journalctl -xe&#34;</span> <span style="color:#00a8c8">for</span> details.

</code></pre></td></tr></table>
</div>
</div><p>出于安全考虑，我们专门创建了snmptt用户，用于运行snmptt服务，这个设置可能会导致zabbix无法正确接收snmp trap消息，具体原因见本文后续关于snmptt安全设置的说明。</p>
<p>安装到最后，准备启动的时候报错了，使用<code>journalctl -xe</code>查看报错提示，大致内容如下图所示。</p>
<p>
        <a data-fancybox="gallery" href="http://img.xy-ylr.cn/picgo/picgo-clipboard-images/2024-0320-110022-ff057d1a4d2085216e6eb84a9175aa2b-41a781.png">
            <img class="mx-auto" alt="snmptt启动报错" src="http://img.xy-ylr.cn/picgo/picgo-clipboard-images/2024-0320-110022-ff057d1a4d2085216e6eb84a9175aa2b-41a781.png" />
        </a>
    </p>
<p>根据提示信息，可以确认是缺少<code>Text::Balanced module</code>这一perl相关模块。在<a href="https://snmptt.sourceforge.net/docs/snmptt.shtml#Requirements">snmptt官网文档&ndash;perl模块</a>有说明，有部分perl模块是必须(Required)的，其中<code>Text::Balanced</code>对应的安装包是<code>perl-Text-Balanced</code>。</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># 启用PowerTools软件库</span>
<span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># dnf install -y yum-utils</span>
<span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># dnf config-manager --set-enabled powertools</span>
<span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># dnf update</span>
<span style="color:#75715e"># 安装缺失的perl模块</span>
<span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># dnf install -y perl-Text-Balanced perl-Config-IniFiles perl-Text-ParseWords perl-Time-HiRes</span> 
<span style="color:#75715e"># 发现文档里下面这两个可选包也必须安装</span>
<span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># dnf install -y perl-Sys-Syslog perl-Net-IP</span> 
<span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># systemctl start snmptt.service</span>
</code></pre></td></tr></table>
</div>
</div><p>以上这些perl相关模块以及前面安装的net-snmp包，都是安装snmptt的前置条件，官方文档安装步骤中的第一步，一开始被我看漏了。</p>
<p>其中<a href="https://metacpan.org/pod/Config::IniFiles">Config::IniFiles</a>模块的包在rhel系linux中是<code>perl-Config-IniFiles</code>，还需要额外的<strong>PowerTools</strong>软件库支持，参考<a href="https://orcacore.com/enable-epel-powertools-almalinux-8/#install-epel-repository-on-almalinux-8">Enable EPEL and PowerTools on AlmaLinux 8</a>，<a href="https://www.jianshu.com/p/c41066b40caf">简书-如何在CentOS8服务器上启用PowerTools</a>。</p>
<p>等到缺失模块全部安装完成之后，就可以通过<code>systemctl start snmptt.service</code>顺利启动snmptt服务了，可以通过<code>systemctl status snmptt.service</code>查看运行状态。</p>
<h2 id="配置">配置</h2>
<h3 id="配置snmptrapd">配置snmptrapd</h3>
<p>配置snmptrapd就是编辑<code>/etc/snmp/snmptrapd.conf</code>文件，大致如下：</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># vi /etc/snmp/snmptrapd.conf</span>
authCommunity   log,execute,net z@bbix
<span style="color:#75715e"># 用于禁用 SNMPv3 的授权检查</span>
disableAuthorization yes
<span style="color:#75715e"># Net-SNMP Standard handler模式接入外部解释器</span>
<span style="color:#75715e"># traphandle   default    /usr/sbin/snmptthandler</span>
<span style="color:#75715e"># Net-SNMP Embedded handler模式接入外部解释器</span>
perl <span style="color:#00a8c8">do</span> <span style="color:#d88200">&#34;/usr/sbin/snmptthandler-embedded&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p><code>authCommunity</code>主要是配置snmptrapd接收trap消息的团体字，在最后一个字段，默认是<code>public</code>，根据实际需要进行修改，比如<code>z@bbix</code>，后续交换机、服务器等被管理设备配置的snmptrap的团体字也要用这个。</p>
<p><code>disableAuthorization</code>是配置SNMPv3才会用到的，这里省略应该也可以。如果是使用snmp v3版本的，还需要额外一些配置，请参考<a href="https://net-snmp.sourceforge.io/wiki/index.php/TUT:Configuring_snmptrapd">官网</a>。</p>
<p><code>traphandle</code>和<code>perl do</code>都是配置snmptrapd调用的外部解释器，具体使用哪一条，要看snmptrapd的运行模式（标准式standard、嵌入式embedded），可以通过以下命令来确认，如果返回的结果中带有<code>perl PERLCODE</code>那就是嵌入式（好像这也是推荐模式，系统开销更小什么的）。</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># snmptrapd -H 2&gt;&amp;1 | grep perl</span>
    perl                     PERLCODE
    perlInitFile             string
<span style="color:#75715e"># 根据实际需求把snmptt包里的snmptthandler或者snmptthandler-embedded复制到/usr/sbin/</span>
<span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># cp snmptthandler /usr/sbin/</span>
<span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># cp snmptthandler-embedded /usr/sbin/</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>补充</strong>：<strong><u>很重要</u></strong>！在snmptt官网还有个推荐配置snmptrapd带<code>-On</code>参数启动，效果是让snmptrapd以数字形式传递OID，并防止SNMPTT不得不将符号名称转换为数字形式。如果系统没有安装<strong>net-snmp perl模块</strong>，则必须使用带<code>-On</code>启动。</p>
<p>因为官方文档里有句话：“Note:  <strong>The -On option is recommended</strong>.” 我把这个理解为是推荐配置选项，大概是我英语不行，这实际上是<strong>必须配置选项</strong>，在修改这个snmptrapd服务的启动方式之前，不管怎么发起snmptrap测试，都只有snmptrapd的日志记录，而没有snmptt的日志记录。</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># systemctl edit --full snmptrapd.service</span>
<span style="color:#75715e"># 将 Environment=OPTIONS=&#34;-Lsd&#34; 修改为 Environment=&#34;OPTIONS=-Lsd -On&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>带<code>-On</code>参数启动snmptrapd服务的状态如下图，如果你的snmptrapd不带有<code>-On</code>参数，请参考上面的命令进行修改。</p>
<p>
        <a data-fancybox="gallery" href="http://img.xy-ylr.cn/picgo/picgo-clipboard-images/2024-0322-100719-d6357adef7702002b990dd9714ba6ded-c22ac9.png">
            <img class="mx-auto" alt="dai-On参数启动snmptrapd" src="http://img.xy-ylr.cn/picgo/picgo-clipboard-images/2024-0322-100719-d6357adef7702002b990dd9714ba6ded-c22ac9.png" />
        </a>
    </p>
<h3 id="配置snmptt">配置snmptt</h3>
<p><code>snmptt.ini</code>配置文件大概确认以下配置项就可以了，其他的保持默认配置</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#75715e"># vi /etc/snmptt/snmptt.ini</span>
<span style="color:#75715e"># &#39;standalone&#39; or &#39;daemon&#39;，推荐使用daemon</span>
<span style="color:#75af00">mode</span> <span style="color:#f92672">=</span> <span style="color:#d88200">daemon</span>
<span style="color:#75715e"># 启用 NET-SNMP 包中的 Perl 模块（大概70行左右）</span>
<span style="color:#75af00">net_snmp_perl_enable</span> <span style="color:#f92672">=</span> <span style="color:#d88200">1</span>
<span style="color:#75715e"># 启用日志记录（大概300行上下）</span>
<span style="color:#75af00">log_enable</span> <span style="color:#f92672">=</span> <span style="color:#d88200">1</span>
<span style="color:#75af00">log_file</span> <span style="color:#f92672">=</span> <span style="color:#d88200">/var/log/snmptt/snmptt.log</span>
<span style="color:#75715e"># 设置日期时间格式（大概230行）</span>
<span style="color:#75af00">date_time_format</span> <span style="color:#f92672">=</span> <span style="color:#d88200">%Y/%m/%d %H:%M:%S</span>
<span style="color:#75715e"># 以OID短名称及模块名来显示（大概100行）</span>
<span style="color:#75af00">translate_log_trap_oid</span> <span style="color:#f92672">=</span> <span style="color:#d88200">2</span>

<span style="color:#00a8c8">[TrapFiles]</span>
<span style="color:#75715e"># 指定snmptt.conf规则文件路径。</span>
<span style="color:#75715e"># 如果定义的规则很多，拆分成了多个文件，也都把文件路径写在两个END之间。比如</span>
<span style="color:#75715e"># /etc/snmptt/snmptt.generic.conf</span>
<span style="color:#75715e"># /etc/snmptt/snmptt.h3c.conf</span>
<span style="color:#75af00">snmptt_conf_files</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&lt;&lt;END</span>
<span style="color:#75af00">/etc/snmptt/snmptt.conf</span>
<span style="color:#75af00">END</span>
</code></pre></td></tr></table>
</div>
</div><p><code>snmptt.conf</code>是snmptt解析trap消息的格式化规则文件，我们根据zabbix要求自定义一些规则，自定义<code>snmptt.conf</code>规则参考<a href="https://snmptt.sourceforge.net/docs/snmptt.shtml#SNMPTT.CONF-Configuration-file-format">snmptt官方的文件语法格式介绍</a>。</p>
<p><a href="https://www.zabbix.com/documentation/6.0/zh/manual/config/items/itemtypes/snmptrap#%E9%85%8D%E7%BD%AE-snmptt">zabbix官方介绍</a>每个FORMAT格式化语句应以“ZBXTRAP [address]”开头，其中[address] 将与 Zabbix 上 SNMP 接口的 IP 和 DNS 地址进行比较；不要使用未知的陷阱 - Zabbix 将无法识别它们。 可以通过在 snmptt.conf 中定义一般事件来处理未知陷阱：<code>EVENT general .* &quot;General event&quot; Normal</code></p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># vi /etc/snmp/snmptt.conf</span>
<span style="color:#75715e"># 匹配Linkdown的规则</span>
EVENT LinkDown .1.3.6.1.6.3.1.1.5.3 <span style="color:#d88200">&#34;Status Events&#34;</span> Warning
FORMAT ZBXTRAP <span style="color:#111">$aA</span> LinkDown on interface <span style="color:#111">$4</span>.  Admin state: <span style="color:#111">$2</span>.  Operational state: <span style="color:#111">$3</span>

<span style="color:#75715e"># 匹配Linkup的规则</span>
EVENT LinkUp .1.3.6.1.6.3.1.1.5.4 <span style="color:#d88200">&#34;Status Events&#34;</span> Normal
FORMAT ZBXTRAP <span style="color:#111">$aA</span> Linkup on interface <span style="color:#111">$4</span>.  Admin state: <span style="color:#111">$2</span>.  Operational state: <span style="color:#111">$3</span>

<span style="color:#75715e"># 默认规则，没有其他规则匹配上时，所有trap信息都按此规则处理</span>
EVENT general .* <span style="color:#d88200">&#34;General event&#34;</span> Normal
FORMAT ZBXTRAP <span style="color:#111">$aA</span> <span style="color:#111">$1</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>个人理解</strong>：snmp trap可以发送的消息有很多，比如端口的up/down、端口带宽使用率、cpu/内存等的资源使用率、风扇/电源等的故障……</p>
<p>一开始可以只配置一条默认规则，但是当我们对于zabbix的使用精通到一定程度，也为了更精细化的运维，我们可以为各种故障赋予不同的权重，根据各种不同的故障告警信息配置独立的格式化规则，并在zabbix主机管理中创建单独的监控项。然后配合触发器等，配置不同的告警提示等级以及不同的告警文字颜色。</p>
<h3 id="配置zabbix">配置zabbix</h3>
<p>编辑<code>zabbix_server.conf</code>配置文件，启用snmptrap功能并指定解释器日志文件路径，如果是zabbix代理，编辑<code>zabbix_proxy.conf</code>文件。</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># vi /etc/zabbix/zabbix_server.conf</span>
<span style="color:#75715e"># 启用StartSNMPTrapper，大概400行</span>
<span style="color:#111">StartSNMPTrapper</span><span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
<span style="color:#75715e"># 指定snmptt日志文件路径</span>
<span style="color:#111">SNMPTrapperFile</span><span style="color:#f92672">=</span>/var/log/snmptt/snmptt.log

<span style="color:#75715e"># 配置完成后重启zabbix服务</span>
<span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># systemctl restart zabbix-server.service</span>
</code></pre></td></tr></table>
</div>
</div><p>配置完成后需要重启zabbix服务，然后还需要在zabbix web页面中为主机添加类型为<strong>snmp trap</strong>的监控项。</p>
<p>如下两张截图，可以使用<code>snmptrap[&lt;regex&gt;]</code>创建指定监控项，regex是正则表达式，用于匹配snmp trap信息中的特殊文本，匹配到的都会被这个监控项所捕获；可以只创建<code>snmptrap.fallback</code>键值的监控项，他会捕获所有未匹配到<code>snmptrap[]</code>监控项的snmp trap信息。</p>
<p>信息类型选择日志格式，日志时间格式可以留空，因为我们刚才在配置<code>snmptt.ini</code>的时候，已经对时间格式做过格式化了。</p>
<p>
        <a data-fancybox="gallery" href="http://img.xy-ylr.cn/picgo/picgo-clipboard-images/2024-0324-154916-5168bf7a6309dbcf132a3cbb03bc8910-2b288c.png">
            <img class="mx-auto" alt="snmptrap专项监控" src="http://img.xy-ylr.cn/picgo/picgo-clipboard-images/2024-0324-154916-5168bf7a6309dbcf132a3cbb03bc8910-2b288c.png" />
        </a>
    </p>
<p>
        <a data-fancybox="gallery" href="http://img.xy-ylr.cn/picgo/picgo-clipboard-images/2024-0324-155034-c1605d50f98334b435871a0cd86cca24-5b6a61.png">
            <img class="mx-auto" alt="snmptrap默认监控" src="http://img.xy-ylr.cn/picgo/picgo-clipboard-images/2024-0324-155034-c1605d50f98334b435871a0cd86cca24-5b6a61.png" />
        </a>
    </p>
<h2 id="验证配置">验证配置</h2>
<p>在上文配置snmptrapd、snmptt、zabbix的时候，都可以尝试发送trap消息来验证配置是否成功。</p>
<p>如果被管理设备是交换机的话，配置好snmp相关内容后，主动down一下某个端口，交换机应该就会自动发送trap消息了。参考<a href="/it/snmp/#%E5%8D%8E%E4%B8%BA%E5%8D%8E%E4%B8%89%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%85%8D%E7%BD%AEsnmp">华为华三交换机配置snmp</a>。</p>
<p>如果被管理设备是linux系统的话，我们可以使用snmptrap命令主动发起。参考<a href="/it/snmp/#snmp-trap">linux发送snmp trap</a>。</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># 在本地发起snmptrap测试，也可以在被管理的linux设备上发起</span>
<span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># snmptrap -v 2c -c z@bbix 127.0.0.1 .1.3.6.1.6.3.1.1.5.3 .1.3.6.1.6.3.1.1.5.3 ifIndex i 2 ifAdminStatus i 1 ifOperStatus i 2</span>
<span style="color:#f92672">[</span>xy@localhost ~<span style="color:#f92672">]</span>$ snmptrap -v2c -c z@bbix 192.168.120.18:162 <span style="color:#d88200">&#39;&#39;</span> UPDATE 1.3.6.1.2.1.1.5.0 s <span style="color:#d88200">&#34;Test Trap Message~~&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>如果snmptrapd配置成功了，查看<code>/var/log/messages</code>日志文件，我们可以看到带有**snmptrapd[]**字眼的日志记录。</p>
<p>
        <a data-fancybox="gallery" href="http://img.xy-ylr.cn/picgo/picgo-clipboard-images/2024-0324-160744-0819c83a0ff5eb7befd58d51a0a4afa2-574182.png">
            <img class="mx-auto" alt="snmptrapd日志截图" src="http://img.xy-ylr.cn/picgo/picgo-clipboard-images/2024-0324-160744-0819c83a0ff5eb7befd58d51a0a4afa2-574182.png" />
        </a>
    </p>
<p>如果snmptt还没完成配置，上述截图中snmptt相关的日志可能还会带有“No such file or directory”等字眼。</p>
<p>等到snmptt也配置完成，就会类似上述截图中的样子，或者在<code>/etc/log/snmptt/snmptt.log</code>中也能看到类似下面截图的内容。</p>
<p>
        <a data-fancybox="gallery" href="http://img.xy-ylr.cn/picgo/picgo-clipboard-images/2024-0324-162848-dd2f719042bb1aafe69d5c4540c0c0ea-d64f1f.png">
            <img class="mx-auto" alt="snmptt.log截图" src="http://img.xy-ylr.cn/picgo/picgo-clipboard-images/2024-0324-162848-dd2f719042bb1aafe69d5c4540c0c0ea-d64f1f.png" />
        </a>
    </p>
<p>如果zabbix也配置完成了，那在zabbix web端的<strong>检测-&gt;主机</strong>页面，选择对应主机的<strong>最新数据</strong>，找到之前配置的监控项，能看到相关内容，点击<strong>历史记录</strong>还能看到更多内容。</p>
<p>
        <a data-fancybox="gallery" href="http://img.xy-ylr.cn/picgo/picgo-clipboard-images/2024-0324-163500-1607b15940b23f9acce44cd1279a3323-143646.png">
            <img class="mx-auto" alt="最新数据" src="http://img.xy-ylr.cn/picgo/picgo-clipboard-images/2024-0324-163500-1607b15940b23f9acce44cd1279a3323-143646.png" />
        </a>
    </p>
<p>
        <a data-fancybox="gallery" href="http://img.xy-ylr.cn/picgo/picgo-clipboard-images/2024-0324-163530-7f68e41fed3acc45ebaae1836c7b16dd-0dd79a.png">
            <img class="mx-auto" alt="历史记录" src="http://img.xy-ylr.cn/picgo/picgo-clipboard-images/2024-0324-163530-7f68e41fed3acc45ebaae1836c7b16dd-0dd79a.png" />
        </a>
    </p>
<h2 id="关于snmptt安全设置">关于snmptt安全设置</h2>
<p>在手动安装snmptt的时候，出于安全考虑，我们创建了snmptt用户和用户组，专门用于运行snmptt程序，并在创建相关目录的时候，配置目录权限为<strong>750</strong>。这会导致snmptt用户组以外的用户，无法读取<code>/etc/log/snmptt</code>目录下的日志文件内容。</p>
<p>而对于zabbix服务，我们以默认方式安装的时候，大概也会创建一个zabbix用户来运行zabbix_server等相关程序。</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># 虽然日志文件对其他用户可读</span>
<span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># ll /var/log/snmptt/</span>
total <span style="color:#ae81ff">8</span>
-rw-rw-r-- <span style="color:#ae81ff">1</span> snmptt snmptt <span style="color:#ae81ff">3407</span> Mar <span style="color:#ae81ff">23</span> 11:49 snmptt.log
-rw-rw-r-- <span style="color:#ae81ff">1</span> snmptt snmptt <span style="color:#ae81ff">1881</span> Mar <span style="color:#ae81ff">21</span> 20:53 snmpttunknown.log
<span style="color:#75715e"># 但是日志文件所在目录对其他用户没放开权限</span>
<span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># ll /var/log/snmptt/ -d</span>
drwxr-x--- <span style="color:#ae81ff">2</span> snmptt snmptt <span style="color:#ae81ff">49</span> Mar <span style="color:#ae81ff">21</span> 14:40 /var/log/snmptt/
<span style="color:#75715e"># zabbix_server服务由zabbix用户启动，包括snmp trapper进程</span>
<span style="color:#f92672">[</span>root@appliance ~<span style="color:#f92672">]</span><span style="color:#75715e"># ps -ef | grep zabbix_server</span>
zabbix    <span style="color:#ae81ff">125118</span>  0.0  0.2 <span style="color:#ae81ff">192036</span>  <span style="color:#ae81ff">8660</span> ?        S    Mar23   0:04 /usr/sbin/zabbix_server -c /etc/zabbix/zabbix_server.conf
zabbix    <span style="color:#ae81ff">125119</span>  0.0  0.1 <span style="color:#ae81ff">146880</span>  <span style="color:#ae81ff">4184</span> ?        S    Mar23   0:09 /usr/sbin/zabbix_server: ha manager
……
zabbix    <span style="color:#ae81ff">125147</span>  0.0  0.1 <span style="color:#ae81ff">192036</span>  <span style="color:#ae81ff">4200</span> ?        S    Mar23   0:04 /usr/sbin/zabbix_server: snmp trapper <span style="color:#f92672">[</span>processed data in 0.000071 sec, idle <span style="color:#ae81ff">1</span> sec<span style="color:#f92672">]</span>

<span style="color:#75715e"># zabbix用户无权查看/var/log/snmptt目录下的文件及内容</span>
<span style="color:#f92672">[</span>root@appliance ~<span style="color:#f92672">]</span><span style="color:#75715e"># sudo -u zabbix less /var/log/snmptt/snmptt.log</span>
/var/log/snmptt/snmptt.log: Permission denied
<span style="color:#f92672">[</span>root@appliance ~<span style="color:#f92672">]</span><span style="color:#75715e"># sudo -u zabbix ls /var/log/snmptt</span>
ls: cannot open directory <span style="color:#d88200">&#39;/var/log/snmptt&#39;</span>: Permission denied
<span style="color:#75715e"># zabbix-server.log日志中也记录着无权查看snmptt.log</span>
<span style="color:#f92672">[</span>root@appliance ~<span style="color:#f92672">]</span><span style="color:#75715e"># cat /var/log/zabbix/zabbix_server.log</span>
125147:20240323:220832.904 cannot open SNMP trapper file <span style="color:#d88200">&#34;/var/log/snmptt/snmptt.log&#34;</span>: <span style="color:#f92672">[</span>13<span style="color:#f92672">]</span> Permission denied
125147:20240323:220932.005 cannot open SNMP trapper file <span style="color:#d88200">&#34;/var/log/snmptt/snmptt.log&#34;</span>: <span style="color:#f92672">[</span>13<span style="color:#f92672">]</span> Permission denied
125147:20240323:221032.103 cannot open SNMP trapper file <span style="color:#d88200">&#34;/var/log/snmptt/snmptt.log&#34;</span>: <span style="color:#f92672">[</span>13<span style="color:#f92672">]</span> Permission denied
125147:20240323:221132.202 cannot open SNMP trapper file <span style="color:#d88200">&#34;/var/log/snmptt/snmptt.log&#34;</span>: <span style="color:#f92672">[</span>13<span style="color:#f92672">]</span> Permission denied
</code></pre></td></tr></table>
</div>
</div><p>这造成的结果就是，虽然我们snmptrapd、snmptt等一系列配置，已经能够正常接收被管理设备发送的trap信息。zabbix_server.conf也配置好了从snmptt.log读取日志，但是由于权限不足，却看不到文件内容，也就导致在zabbix web页面无法看到相关主机的trap数据。</p>
<p>为了解决这个问题，我们可以把zabbix用户加入snmptt用户组，获得读取snmptt.log日志文件内容的权限（<strong>记得修改完成后重启zabbix-server服务</strong>）。</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@appliance ~<span style="color:#f92672">]</span><span style="color:#75715e"># usermod -a -G snmptt zabbix</span>
<span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># groups zabbix</span>
zabbix : zabbix snmptt
<span style="color:#f92672">[</span>root@appliance ~<span style="color:#f92672">]</span><span style="color:#75715e"># sudo -u zabbix cat /var/log/snmptt/snmptt.log</span>
Mon Aug <span style="color:#ae81ff">16</span> 22:06:35 <span style="color:#ae81ff">2004</span> .1.3.6.1.6.3.1.1.5.3 Normal <span style="color:#d88200">&#34;Status Events&#34;</span> router01 - Link down on interface 3.  Admin state: 2.  Operational state: <span style="color:#ae81ff">3</span>
2004/08/16 22:06:35 SNMPv2-SMI::internet.0.0.0.0.0 Normal <span style="color:#d88200">&#34;General event&#34;</span> server01.domain.com - ZBXTRAP 192.168.1.1 SERVER01
2024/03/21 20:41:26 IF-MIB::linkDown Normal <span style="color:#d88200">&#34;Status Events&#34;</span> 127.0.0.1 - Link down on interface 2.  Admin state: up.  Operational state: down
2024/03/21 20:46:54 UCD-SNMP-MIB::versionUpdateConfig Normal <span style="color:#d88200">&#34;General event&#34;</span> 192.168.120.11 - ZBXTRAP 192.168.120.11 Test Trap Message~~~
2024/03/21 20:57:01 UCD-SNMP-MIB::versionUpdateConfig Normal <span style="color:#d88200">&#34;General event&#34;</span> 192.168.120.11 - ZBXTRAP 192.168.120.11 Test Trap Message~...
2024/03/21 20:57:05 IF-MIB::linkDown Normal <span style="color:#d88200">&#34;Status Events&#34;</span> 127.0.0.1 - Link down on interface 2.  Admin state: up.  Operational state: down
<span style="color:#75715e"># 重点！完成之后需要重启zabbix服务，更改才能生效</span>
<span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># systemctl restart zabbix-server.service</span>
</code></pre></td></tr></table>
</div>
</div><p>或者将<code>/var/log/snmptt/</code>目录的所属用户组改成zabbix组的应该也可以：<code>chown -R snmptt.zabbix /var/log/snmptt</code>。</p>
<p>或者也可以考虑在配置<code>snmptt.ini</code>的时候，修改运行id为zabbix的运行用户，并将snmptt相关目录的所有者也改为zabbix的（未测试，不确定该方案是否可行，可能还需要修改别的一些东西）：</p>
<div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#75715e"># vi /etc/snmptt/snmptt.ini</span>
<span style="color:#75af00">daemon_uid</span> <span style="color:#f92672">=</span> <span style="color:#d88200">zabbix</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># chown -R zabbix.zabbix /var/log/snmptt</span>
<span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># chown -R zabbix.zabbix /var/spool/snmptt</span>
<span style="color:#f92672">[</span>root@appliance snmptt<span style="color:#f92672">]</span><span style="color:#75715e"># chown -R zabbix.zabbix /etc/snmptt</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="参考">参考</h2>
<p><a href="https://net-snmp.sourceforge.io/wiki/index.php/TUT:Configuring_snmptrapd">net-snmp官方文档：配置snmptrapd</a>。</p>
<p><a href="http://www.net-snmp.org/docs/man/snmptrapd.conf.html">snmptrapd.conf的man page</a>。</p>
<p><a href="https://snmptt.sourceforge.net/docs/snmptt.shtml#Installation">snmptt官方文档：安装配置snmptt</a>。</p>
<p><a href="https://www.zabbix.com/documentation/6.0/zh/manual/config/items/itemtypes/snmptrap#%E7%B3%BB%E7%BB%9F%E8%A6%81%E6%B1%82">zabbix官方文档-snmp trap</a>。</p>
<p><a href="https://www.cnblogs.com/zhenwei66/p/10483473.html">zabbix利用SNMPTrap接收交换机主动告警</a>。</p>
<p><a href="https://www.cnblogs.com/xiaolang666/p/15215075.html">zabbix利用SNMPTrap接收华为存储服务器主动告警</a>。</p>
        </div>

        
<div class="post-archive">
    <ul class="post-copyright">
        <li><strong>原文作者：</strong><a rel="author" href="https://xy-ylr.github.io">四十荀</a></li>
        <li style="word-break:break-all"><strong>原文链接：</strong><a href="https://xy-ylr.github.io/it/zabbix_snmp_trap/">https://xy-ylr.github.io/it/zabbix_snmp_trap/</a></li>
        <li><strong>版权声明：</strong>本作品采用<a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可，非商业转载请注明出处（作者，原文链接），商业转载请联系作者获得授权。</li>
    </ul>
</div>
<br/>



        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/it/linux_install_zabbix/">Linux操作系统上安装Zabbix运维工具并基础配置</a></li>
        
        <li><a href="/it/debian_install/">安装Debian系统后的基础配置</a></li>
        
        <li><a href="/it/linux_alias/">Linux系统中alias别名功能</a></li>
        
        <li><a href="/it/linux_fdisk/">Linux系统磁盘的分区 格式化与挂载</a></li>
        
        <li><a href="/it/linux_lvm/">Linux lvm磁盘管理</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='/tags/zabbix'>zabbix</a></li>
                
                <li><a href='/tags/snmp-trap'>snmp trap</a></li>
                
                <li><a href='/tags/%E8%BF%90%E7%BB%B4'>运维</a></li>
                
                <li><a href='/tags/linux'>linux</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "xy-ylr/blog-comments"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
    
    

</div>

                    <footer id="footer">
    <div>
        &copy; 2024 <a href="https://xy-ylr.github.io">四十荀的博客 By 四十荀</a>
        
        | <a rel="nofollow" target="_blank" href="http://beian.miit.gov.cn/">浙ICP备2023002264号-1</a>
        
    </div>
    <br />
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://www.flysnow.org/" target="_black"><span class="badge-subject">Design by</span><span class="badge-value bg-brightgreen">飞雪无情</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>
</footer>


    
    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script><script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>
    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://xy-ylr.github.io/search' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://xy-ylr.github.io">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://xy-ylr.github.io/it/kali_configure_openvas/" title="Kali2024.1安装配置openvas(gvm)漏洞扫描软件">Kali2024.1安装配置openvas(gvm)漏洞扫描软件</a>
    </li>
    
    <li>
        <a href="https://xy-ylr.github.io/it/linux_iso2local_yum/" title="Linux使用iso镜像制作本地源">Linux使用iso镜像制作本地源</a>
    </li>
    
    <li>
        <a href="https://xy-ylr.github.io/it/vmware_patches_updates/" title="Vmware更新补丁方法">Vmware更新补丁方法</a>
    </li>
    
    <li>
        <a href="https://xy-ylr.github.io/it/zabbix_snmp_trap/" title="Zabbix配置snmp trap接收主动告警">Zabbix配置snmp trap接收主动告警</a>
    </li>
    
    <li>
        <a href="https://xy-ylr.github.io/it/vlmcsd_kms/" title="利用VLMCSD部署本地KMS服务器">利用VLMCSD部署本地KMS服务器</a>
    </li>
    
    <li>
        <a href="https://xy-ylr.github.io/it/snmp/" title="SNMP基础">SNMP基础</a>
    </li>
    
    <li>
        <a href="https://xy-ylr.github.io/it/huawei_css/" title="华为交换机STACK堆叠与CSS集群配置">华为交换机STACK堆叠与CSS集群配置</a>
    </li>
    
    <li>
        <a href="https://xy-ylr.github.io/it/h3c_complex_nat/" title="H3c防火墙双向地址转换配置">H3c防火墙双向地址转换配置</a>
    </li>
    
    <li>
        <a href="https://xy-ylr.github.io/it/h3c_snat/" title="H3c防火墙源地址转换配置">H3c防火墙源地址转换配置</a>
    </li>
    
    <li>
        <a href="https://xy-ylr.github.io/it/h3c_network_nat/" title="H3C防火墙NAT配置">H3C防火墙NAT配置</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href='/categories/'>分类</a></h3>
<ul class="widget-list">
    
    <li><a href="https://xy-ylr.github.io/categories/Windows/">Windows (1)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/debian/">debian (1)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/git/">git (4)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/linux/">linux (9)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/office%E5%8A%9E%E5%85%AC/">office办公 (1)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/snmp/">snmp (1)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/vmware/">vmware (1)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/zabbix/">zabbix (2)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/%E5%81%A5%E8%BA%AB/">健身 (1)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/%E5%86%9C%E4%B8%9A/">农业 (1)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/%E7%90%86%E8%B4%A2/">理财 (1)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/%E7%BC%96%E8%BE%91/">编辑 (3)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/%E7%BD%91%E7%BB%9C/">网络 (11)</a></li>
    
    <li><a href="https://xy-ylr.github.io/categories/%E8%BF%90%E7%BB%B4/">运维 (2)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/tags/'>标签</a></h3>
<div class="tagcloud">
    
    <a href="https://xy-ylr.github.io/tags/DHCP/">DHCP</a>
    
    <a href="https://xy-ylr.github.io/tags/alias/">alias</a>
    
    <a href="https://xy-ylr.github.io/tags/apt/">apt</a>
    
    <a href="https://xy-ylr.github.io/tags/bash-shell/">bash shell</a>
    
    <a href="https://xy-ylr.github.io/tags/css%E9%9B%86%E7%BE%A4/">css集群</a>
    
    <a href="https://xy-ylr.github.io/tags/debian/">debian</a>
    
    <a href="https://xy-ylr.github.io/tags/dnf/">dnf</a>
    
    <a href="https://xy-ylr.github.io/tags/excel/">excel</a>
    
    <a href="https://xy-ylr.github.io/tags/firewalld/">firewalld</a>
    
    <a href="https://xy-ylr.github.io/tags/git/">git</a>
    
    <a href="https://xy-ylr.github.io/tags/github/">github</a>
    
    <a href="https://xy-ylr.github.io/tags/h3c/">h3c</a>
    
    <a href="https://xy-ylr.github.io/tags/h3c%E9%98%B2%E7%81%AB%E5%A2%99/">h3c防火墙</a>
    
    <a href="https://xy-ylr.github.io/tags/hugo/">hugo</a>
    
    <a href="https://xy-ylr.github.io/tags/irf/">irf</a>
    
    <a href="https://xy-ylr.github.io/tags/kali/">kali</a>
    
    <a href="https://xy-ylr.github.io/tags/kms%E6%BF%80%E6%B4%BB/">kms激活</a>
    
    <a href="https://xy-ylr.github.io/tags/linux/">linux</a>
    
    <a href="https://xy-ylr.github.io/tags/lvm/">lvm</a>
    
    <a href="https://xy-ylr.github.io/tags/nat/">nat</a>
    
    <a href="https://xy-ylr.github.io/tags/nat%E9%85%8D%E7%BD%AE/">nat配置</a>
    
    <a href="https://xy-ylr.github.io/tags/network/">network</a>
    
    <a href="https://xy-ylr.github.io/tags/openvasgvm/">openvas(gvm)</a>
    
    <a href="https://xy-ylr.github.io/tags/patch-update/">patch update</a>
    
    <a href="https://xy-ylr.github.io/tags/rime/">rime</a>
    
    <a href="https://xy-ylr.github.io/tags/selinux/">selinux</a>
    
    <a href="https://xy-ylr.github.io/tags/snmp/">snmp</a>
    
    <a href="https://xy-ylr.github.io/tags/snmp-trap/">snmp trap</a>
    
    <a href="https://xy-ylr.github.io/tags/ssh/">ssh</a>
    
    <a href="https://xy-ylr.github.io/tags/sudo/">sudo</a>
    
    <a href="https://xy-ylr.github.io/tags/typora/">typora</a>
    
    <a href="https://xy-ylr.github.io/tags/vmware/">vmware</a>
    
    <a href="https://xy-ylr.github.io/tags/windows%E6%BF%80%E6%B4%BB/">windows激活</a>
    
    <a href="https://xy-ylr.github.io/tags/yum/">yum</a>
    
    <a href="https://xy-ylr.github.io/tags/zabbix/">zabbix</a>
    
    <a href="https://xy-ylr.github.io/tags/%E5%81%A5%E8%BA%AB/">健身</a>
    
    <a href="https://xy-ylr.github.io/tags/%E5%86%9C%E4%B8%9A/">农业</a>
    
    <a href="https://xy-ylr.github.io/tags/%E5%88%86%E5%8C%BA/">分区</a>
    
    <a href="https://xy-ylr.github.io/tags/%E5%8D%8E%E4%B8%BA/">华为</a>
    
    <a href="https://xy-ylr.github.io/tags/%E6%8C%82%E8%BD%BD/">挂载</a>
    
    <a href="https://xy-ylr.github.io/tags/%E6%A0%BC%E5%BC%8F%E5%8C%96/">格式化</a>
    
    <a href="https://xy-ylr.github.io/tags/%E6%BC%8F%E6%89%AB/">漏扫</a>
    
    <a href="https://xy-ylr.github.io/tags/%E7%82%92%E8%82%A1/">炒股</a>
    
    <a href="https://xy-ylr.github.io/tags/%E7%90%86%E8%B4%A2/">理财</a>
    
    <a href="https://xy-ylr.github.io/tags/%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86/">磁盘管理</a>
    
    <a href="https://xy-ylr.github.io/tags/%E7%BD%91%E7%BB%9C/">网络</a>
    
    <a href="https://xy-ylr.github.io/tags/%E7%BD%91%E7%BB%9C-MSTP/">网络, MSTP</a>
    
    <a href="https://xy-ylr.github.io/tags/%E7%BD%91%E7%BB%9C%E4%B8%A2%E5%8C%85/">网络丢包</a>
    
    <a href="https://xy-ylr.github.io/tags/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B%E5%B8%88/">网络工程师</a>
    
    <a href="https://xy-ylr.github.io/tags/%E7%BD%91%E7%BB%9C%E6%8E%92%E9%9A%9C/">网络排障</a>
    
    <a href="https://xy-ylr.github.io/tags/%E7%BD%91%E7%BB%9C%E7%8E%AF%E8%B7%AF/">网络环路</a>
    
    <a href="https://xy-ylr.github.io/tags/%E8%BF%90%E7%BB%B4/">运维</a>
    
</div>
    </section>

    
<section class="widget">
    <h3 class="widget-title">友情链接</h3>
    <ul class="widget-list">
        
        <li>
            <a target="_blank" href="https://www.flysnow.org/" title="飞雪无情的博客">飞雪无情的博客</a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://xy-ylr.github.io/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>

</html>